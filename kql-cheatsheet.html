<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KQL Cheat Sheet - Microsoft Sentinel Guide</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .cheat-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }
        .cheat-card {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 1.25rem;
        }
        .cheat-card h3 {
            color: var(--accent-color);
            margin-bottom: 1rem;
            font-size: 1.1rem;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 0.5rem;
        }
        .cheat-item {
            margin-bottom: 0.75rem;
            font-size: 0.9rem;
        }
        .cheat-item code {
            background: var(--code-bg);
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.85rem;
        }
        .cheat-item .desc {
            color: var(--text-muted);
            font-size: 0.8rem;
            margin-top: 2px;
        }
        .print-btn {
            background: var(--accent-color);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1rem;
            margin-bottom: 2rem;
        }
        .print-btn:hover {
            background: #106ebe;
        }
        @media print {
            .navbar, .sidebar, .print-btn, .footer { display: none !important; }
            .main-content { margin: 0 !important; padding: 1rem !important; }
            .cheat-grid { grid-template-columns: repeat(2, 1fr); }
            .cheat-card { break-inside: avoid; }
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <a href="index.html" class="navbar-brand">
            <svg viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>
            </svg>
            Sentinel Guide
        </a>
        <ul class="navbar-nav">
            <li><a href="index.html">Home</a></li>
            <li><a href="kql-library.html">KQL Library</a></li>
            <li><a href="kql-cheatsheet.html" class="active">Cheat Sheet</a></li>
        </ul>
    </nav>

    <aside class="sidebar">
        <div class="sidebar-section">
            <div class="sidebar-title">Quick Links</div>
            <ul class="sidebar-nav">
                <li><a href="index.html">Home</a></li>
                <li><a href="kql-library.html">KQL Library</a></li>
                <li><a href="kql-cheatsheet.html" class="active">KQL Cheat Sheet</a></li>
            </ul>
        </div>
        <div class="sidebar-section">
            <div class="sidebar-title">Detection</div>
            <ul class="sidebar-nav">
                <li><a href="analytics-rules.html">Analytics Rules</a></li>
                <li><a href="connector-rules.html">Connector Rules</a></li>
                <li><a href="correlation-rules.html">Correlation Rules</a></li>
            </ul>
        </div>
    </aside>

    <main class="main-content">
        <div class="content-container">
            <h1>KQL Quick Reference Cheat Sheet</h1>
            <p>Essential KQL operators, functions, and patterns for Microsoft Sentinel threat hunting and detection engineering.</p>
            
            <button class="print-btn" onclick="window.print()">üñ®Ô∏è Print Cheat Sheet</button>

            <div class="cheat-grid">
                <!-- Basic Operators -->
                <div class="cheat-card">
                    <h3>üìã Basic Operators</h3>
                    <div class="cheat-item">
                        <code>| where Column == "value"</code>
                        <div class="desc">Filter rows (case-sensitive)</div>
                    </div>
                    <div class="cheat-item">
                        <code>| where Column =~ "value"</code>
                        <div class="desc">Filter rows (case-insensitive)</div>
                    </div>
                    <div class="cheat-item">
                        <code>| where Column != "value"</code>
                        <div class="desc">Not equal</div>
                    </div>
                    <div class="cheat-item">
                        <code>| where Column has "text"</code>
                        <div class="desc">Contains substring (case-insensitive)</div>
                    </div>
                    <div class="cheat-item">
                        <code>| where Column contains "text"</code>
                        <div class="desc">Contains (case-sensitive)</div>
                    </div>
                    <div class="cheat-item">
                        <code>| where Column startswith "abc"</code>
                        <div class="desc">Starts with prefix</div>
                    </div>
                    <div class="cheat-item">
                        <code>| where Column endswith ".exe"</code>
                        <div class="desc">Ends with suffix</div>
                    </div>
                    <div class="cheat-item">
                        <code>| where Column matches regex @"\d+"</code>
                        <div class="desc">Regex match</div>
                    </div>
                </div>

                <!-- Multiple Values -->
                <div class="cheat-card">
                    <h3>üì¶ Multiple Values</h3>
                    <div class="cheat-item">
                        <code>| where Column in ("a", "b", "c")</code>
                        <div class="desc">Match any value in list</div>
                    </div>
                    <div class="cheat-item">
                        <code>| where Column !in ("a", "b")</code>
                        <div class="desc">Not in list</div>
                    </div>
                    <div class="cheat-item">
                        <code>| where Column in~ ("A", "B")</code>
                        <div class="desc">In list (case-insensitive)</div>
                    </div>
                    <div class="cheat-item">
                        <code>| where Column has_any ("x", "y")</code>
                        <div class="desc">Contains any substring</div>
                    </div>
                    <div class="cheat-item">
                        <code>| where Column has_all ("x", "y")</code>
                        <div class="desc">Contains all substrings</div>
                    </div>
                    <div class="cheat-item">
                        <code>let list = dynamic(["a","b"]);</code>
                        <div class="desc">Define dynamic array</div>
                    </div>
                </div>

                <!-- Time Filters -->
                <div class="cheat-card">
                    <h3>‚è∞ Time Filters</h3>
                    <div class="cheat-item">
                        <code>| where TimeGenerated > ago(1h)</code>
                        <div class="desc">Last hour</div>
                    </div>
                    <div class="cheat-item">
                        <code>| where TimeGenerated > ago(7d)</code>
                        <div class="desc">Last 7 days</div>
                    </div>
                    <div class="cheat-item">
                        <code>| where TimeGenerated between (ago(2d) .. ago(1d))</code>
                        <div class="desc">Time range</div>
                    </div>
                    <div class="cheat-item">
                        <code>bin(TimeGenerated, 1h)</code>
                        <div class="desc">Group by hour</div>
                    </div>
                    <div class="cheat-item">
                        <code>datetime_diff('hour', t1, t2)</code>
                        <div class="desc">Time difference</div>
                    </div>
                    <div class="cheat-item">
                        <code>format_datetime(t, 'yyyy-MM-dd')</code>
                        <div class="desc">Format datetime</div>
                    </div>
                </div>

                <!-- Aggregations -->
                <div class="cheat-card">
                    <h3>üìä Aggregations</h3>
                    <div class="cheat-item">
                        <code>| summarize count() by Column</code>
                        <div class="desc">Count per group</div>
                    </div>
                    <div class="cheat-item">
                        <code>| summarize dcount(Column)</code>
                        <div class="desc">Distinct count</div>
                    </div>
                    <div class="cheat-item">
                        <code>| summarize sum(Bytes)</code>
                        <div class="desc">Sum values</div>
                    </div>
                    <div class="cheat-item">
                        <code>| summarize avg(Value)</code>
                        <div class="desc">Average</div>
                    </div>
                    <div class="cheat-item">
                        <code>| summarize percentile(Val, 95)</code>
                        <div class="desc">95th percentile</div>
                    </div>
                    <div class="cheat-item">
                        <code>| summarize make_set(Column)</code>
                        <div class="desc">Unique values as array</div>
                    </div>
                    <div class="cheat-item">
                        <code>| summarize make_list(Column)</code>
                        <div class="desc">All values as array</div>
                    </div>
                    <div class="cheat-item">
                        <code>| summarize arg_max(Time, *)</code>
                        <div class="desc">Row with max time</div>
                    </div>
                </div>

                <!-- Joins -->
                <div class="cheat-card">
                    <h3>üîó Joins</h3>
                    <div class="cheat-item">
                        <code>| join kind=inner Table2 on Key</code>
                        <div class="desc">Inner join (matching only)</div>
                    </div>
                    <div class="cheat-item">
                        <code>| join kind=leftouter T2 on Key</code>
                        <div class="desc">Left join (keep all left)</div>
                    </div>
                    <div class="cheat-item">
                        <code>| join kind=leftanti T2 on Key</code>
                        <div class="desc">Left anti (not in right)</div>
                    </div>
                    <div class="cheat-item">
                        <code>| join kind=leftsemi T2 on Key</code>
                        <div class="desc">Left semi (exists in right)</div>
                    </div>
                    <div class="cheat-item">
                        <code>| union Table2</code>
                        <div class="desc">Combine tables</div>
                    </div>
                    <div class="cheat-item">
                        <code>| lookup Table2 on Key</code>
                        <div class="desc">Enrich with lookup</div>
                    </div>
                </div>

                <!-- String Functions -->
                <div class="cheat-card">
                    <h3>üî§ String Functions</h3>
                    <div class="cheat-item">
                        <code>tolower(Column)</code>
                        <div class="desc">Lowercase</div>
                    </div>
                    <div class="cheat-item">
                        <code>toupper(Column)</code>
                        <div class="desc">Uppercase</div>
                    </div>
                    <div class="cheat-item">
                        <code>strlen(Column)</code>
                        <div class="desc">String length</div>
                    </div>
                    <div class="cheat-item">
                        <code>substring(Col, 0, 5)</code>
                        <div class="desc">Extract substring</div>
                    </div>
                    <div class="cheat-item">
                        <code>split(Col, ",")</code>
                        <div class="desc">Split to array</div>
                    </div>
                    <div class="cheat-item">
                        <code>strcat(A, "-", B)</code>
                        <div class="desc">Concatenate strings</div>
                    </div>
                    <div class="cheat-item">
                        <code>replace_string(s, old, new)</code>
                        <div class="desc">Replace text</div>
                    </div>
                    <div class="cheat-item">
                        <code>extract(@"(\d+)", 1, s)</code>
                        <div class="desc">Regex extract</div>
                    </div>
                </div>

                <!-- Parsing -->
                <div class="cheat-card">
                    <h3>üîç Parsing</h3>
                    <div class="cheat-item">
                        <code>| parse Col with * "user=" User " " *</code>
                        <div class="desc">Parse structured text</div>
                    </div>
                    <div class="cheat-item">
                        <code>| parse-json JsonColumn</code>
                        <div class="desc">Parse JSON</div>
                    </div>
                    <div class="cheat-item">
                        <code>| extend Data = parse_json(Col)</code>
                        <div class="desc">JSON to dynamic</div>
                    </div>
                    <div class="cheat-item">
                        <code>| extend Val = Data.field</code>
                        <div class="desc">Access JSON field</div>
                    </div>
                    <div class="cheat-item">
                        <code>| mv-expand ArrayColumn</code>
                        <div class="desc">Expand array to rows</div>
                    </div>
                    <div class="cheat-item">
                        <code>| extend IP = extract_all(@"\d+\.\d+\.\d+\.\d+", s)</code>
                        <div class="desc">Extract all matches</div>
                    </div>
                </div>

                <!-- Projections -->
                <div class="cheat-card">
                    <h3>üì§ Output/Projection</h3>
                    <div class="cheat-item">
                        <code>| project Col1, Col2, Col3</code>
                        <div class="desc">Select columns</div>
                    </div>
                    <div class="cheat-item">
                        <code>| project-away TempCol</code>
                        <div class="desc">Remove columns</div>
                    </div>
                    <div class="cheat-item">
                        <code>| project-rename NewName=OldName</code>
                        <div class="desc">Rename column</div>
                    </div>
                    <div class="cheat-item">
                        <code>| extend NewCol = expression</code>
                        <div class="desc">Add computed column</div>
                    </div>
                    <div class="cheat-item">
                        <code>| top 10 by Count desc</code>
                        <div class="desc">Top N rows</div>
                    </div>
                    <div class="cheat-item">
                        <code>| sort by Time desc</code>
                        <div class="desc">Order rows</div>
                    </div>
                    <div class="cheat-item">
                        <code>| take 100</code>
                        <div class="desc">Limit rows</div>
                    </div>
                    <div class="cheat-item">
                        <code>| distinct Column</code>
                        <div class="desc">Unique values</div>
                    </div>
                </div>

                <!-- Conditional -->
                <div class="cheat-card">
                    <h3>‚ùì Conditional Logic</h3>
                    <div class="cheat-item">
                        <code>iff(condition, true_val, false_val)</code>
                        <div class="desc">If-then-else</div>
                    </div>
                    <div class="cheat-item">
                        <code>case(c1, v1, c2, v2, default)</code>
                        <div class="desc">Multiple conditions</div>
                    </div>
                    <div class="cheat-item">
                        <code>coalesce(a, b, c)</code>
                        <div class="desc">First non-null</div>
                    </div>
                    <div class="cheat-item">
                        <code>isempty(Column)</code>
                        <div class="desc">Check empty/null</div>
                    </div>
                    <div class="cheat-item">
                        <code>isnotempty(Column)</code>
                        <div class="desc">Check not empty</div>
                    </div>
                    <div class="cheat-item">
                        <code>isnull(Column)</code>
                        <div class="desc">Check null</div>
                    </div>
                </div>

                <!-- Sentinel Tables -->
                <div class="cheat-card">
                    <h3>üìä Key Sentinel Tables</h3>
                    <div class="cheat-item">
                        <code>SecurityIncident</code>
                        <div class="desc">Sentinel incidents</div>
                    </div>
                    <div class="cheat-item">
                        <code>SecurityAlert</code>
                        <div class="desc">All security alerts</div>
                    </div>
                    <div class="cheat-item">
                        <code>SigninLogs</code>
                        <div class="desc">Azure AD sign-ins</div>
                    </div>
                    <div class="cheat-item">
                        <code>AuditLogs</code>
                        <div class="desc">Azure AD changes</div>
                    </div>
                    <div class="cheat-item">
                        <code>DeviceProcessEvents</code>
                        <div class="desc">MDE process telemetry</div>
                    </div>
                    <div class="cheat-item">
                        <code>DeviceNetworkEvents</code>
                        <div class="desc">MDE network telemetry</div>
                    </div>
                    <div class="cheat-item">
                        <code>DeviceFileEvents</code>
                        <div class="desc">MDE file telemetry</div>
                    </div>
                    <div class="cheat-item">
                        <code>CommonSecurityLog</code>
                        <div class="desc">CEF/Syslog (firewalls)</div>
                    </div>
                </div>

                <!-- Detection Patterns -->
                <div class="cheat-card">
                    <h3>üéØ Detection Patterns</h3>
                    <div class="cheat-item">
                        <code>| summarize count() by bin(Time, 5m)</code>
                        <div class="desc">Threshold over time</div>
                    </div>
                    <div class="cheat-item">
                        <code>| join kind=inner (baseline) on Key</code>
                        <div class="desc">Compare to baseline</div>
                    </div>
                    <div class="cheat-item">
                        <code>| where count_ > avg_ + (3 * stdev_)</code>
                        <div class="desc">Statistical anomaly</div>
                    </div>
                    <div class="cheat-item">
                        <code>| serialize | prev(Column)</code>
                        <div class="desc">Compare to previous row</div>
                    </div>
                    <div class="cheat-item">
                        <code>_GetWatchlist('name')</code>
                        <div class="desc">Query watchlist</div>
                    </div>
                    <div class="cheat-item">
                        <code>ThreatIntelligenceIndicator</code>
                        <div class="desc">IOC matching table</div>
                    </div>
                </div>

                <!-- Visualization -->
                <div class="cheat-card">
                    <h3>üìà Visualization</h3>
                    <div class="cheat-item">
                        <code>| render timechart</code>
                        <div class="desc">Time series chart</div>
                    </div>
                    <div class="cheat-item">
                        <code>| render barchart</code>
                        <div class="desc">Bar chart</div>
                    </div>
                    <div class="cheat-item">
                        <code>| render piechart</code>
                        <div class="desc">Pie chart</div>
                    </div>
                    <div class="cheat-item">
                        <code>| render columnchart</code>
                        <div class="desc">Column chart</div>
                    </div>
                    <div class="cheat-item">
                        <code>| render scatterchart</code>
                        <div class="desc">Scatter plot</div>
                    </div>
                    <div class="cheat-item">
                        <code>| render table</code>
                        <div class="desc">Table output</div>
                    </div>
                </div>
            </div>

            <footer class="footer">
                <div class="footer-content">
                    <svg class="footer-icon" viewBox="0 0 24 24">
                        <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>
                    </svg>
                    Microsoft Sentinel Ultimate Guide - KQL Cheat Sheet
                </div>
            </footer>
        </div>
    </main>
    <script src="main.js"></script>
</body>
</html>
