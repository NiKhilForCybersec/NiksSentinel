<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Microsoft Sentinel Data Connectors - Connecting data sources, Microsoft and third-party integrations, and ingestion methods.">
    <title>Data Connectors | SIEM Mastery Guide</title>
    <link rel="stylesheet" href="main.css">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ›¡ï¸</text></svg>">
</head>
<body>
    <div class="page-wrapper">
        <button class="mobile-menu-toggle" aria-label="Toggle navigation menu">
            <div class="hamburger"><span></span><span></span><span></span></div>
        </button>
        <div class="sidebar-overlay"></div>
        
        <aside class="sidebar">
            <div class="sidebar-header">
                <a href="index.html" class="sidebar-logo">
                    <div class="logo-icon">ğŸ›¡ï¸</div>
                    <div>
                        <div class="logo-text">SIEM Mastery</div>
                        <div class="logo-subtext">Documentation</div>
                    </div>
                </a>
            </div>
            
                        <nav class="sidebar-nav">
                <!-- Section 1: SIEM Fundamentals -->
                <div class="nav-section">
                    <div class="nav-section-header">
                        <span class="nav-section-title">
                            <span class="nav-section-icon">ğŸ“š</span>
                            <span>SIEM Fundamentals</span>
                        </span>
                        <span class="nav-section-arrow">â–¶</span>
                    </div>
                    <div class="nav-section-items">
                        <a href="1-1-introduction-to-siem.html" class="nav-item">1.1 Introduction to SIEM</a>
                        <a href="1-2-architecture-components.html" class="nav-item">1.2 Architecture & Components</a>
                        <a href="1-3-log-sources-onboarding.html" class="nav-item">1.3 Log Sources & Onboarding</a>
                        <a href="1-4-log-parsing-normalization.html" class="nav-item">1.4 Log Parsing & Normalization</a>
                        <a href="1-5-detection-engineering-fundamentals.html" class="nav-item">1.5 Detection Engineering</a>
                        <a href="1-6-soc-operations-siem.html" class="nav-item">1.6 SOC Operations & SIEM</a>
                    </div>
                </div>
                
                <!-- Section 2: Splunk Fundamentals -->
                <div class="nav-section">
                    <div class="nav-section-header">
                        <span class="nav-section-title">
                            <span class="nav-section-icon">ğŸŸ¢</span>
                            <span>Splunk Fundamentals</span>
                        </span>
                        <span class="nav-section-arrow">â–¶</span>
                    </div>
                    <div class="nav-section-items">
                        <a href="2-1-splunk-architecture.html" class="nav-item">2.1 Splunk Architecture</a>
                        <a href="2-2-installation-configuration.html" class="nav-item">2.2 Installation & Configuration</a>
                        <a href="2-3-data-ingestion.html" class="nav-item">2.3 Data Ingestion</a>
                        <a href="2-4-index-management.html" class="nav-item">2.4 Index Management</a>
                        <a href="2-5-spl-fundamentals.html" class="nav-item">2.5 SPL Fundamentals</a>
                        <a href="2-6-spl-data-retrieval.html" class="nav-item">2.6 SPL Data Retrieval</a>
                        <a href="2-7-spl-transforming.html" class="nav-item">2.7 SPL Transforming</a>
                        <a href="2-8-spl-manipulation.html" class="nav-item">2.8 SPL Manipulation</a>
                        <a href="2-9-spl-advanced.html" class="nav-item">2.9 SPL Advanced</a>
                        <a href="2-10-search-optimization.html" class="nav-item">2.10 Search Optimization</a>
                    </div>
                </div>
                
                <!-- Section 3: Splunk Security Operations -->
                <div class="nav-section">
                    <div class="nav-section-header">
                        <span class="nav-section-title">
                            <span class="nav-section-icon">ğŸ”’</span>
                            <span>Splunk Security Ops</span>
                        </span>
                        <span class="nav-section-arrow">â–¶</span>
                    </div>
                    <div class="nav-section-items">
                        <a href="3-1-splunk-es-overview.html" class="nav-item">3.1 Enterprise Security Overview</a>
                        <a href="3-2-notable-events.html" class="nav-item">3.2 Notable Events</a>
                        <a href="3-3-correlation-searches.html" class="nav-item">3.3 Correlation Searches</a>
                        <a href="3-4-risk-based-alerting.html" class="nav-item">3.4 Risk-Based Alerting</a>
                        <a href="3-5-threat-intelligence.html" class="nav-item">3.5 Threat Intelligence</a>
                        <a href="3-6-asset-identity.html" class="nav-item">3.6 Asset & Identity</a>
                        <a href="3-7-security-dashboards.html" class="nav-item">3.7 Security Dashboards</a>
                        <a href="3-8-es-administration.html" class="nav-item">3.8 ES Administration</a>
                    </div>
                </div>
                
                <!-- Section 4: Splunk SOAR -->
                <div class="nav-section">
                    <div class="nav-section-header">
                        <span class="nav-section-title">
                            <span class="nav-section-icon">âš¡</span>
                            <span>Splunk SOAR</span>
                        </span>
                        <span class="nav-section-arrow">â–¶</span>
                    </div>
                    <div class="nav-section-items">
                        <a href="4-1-soar-overview.html" class="nav-item">4.1 SOAR Overview</a>
                        <a href="4-2-playbooks.html" class="nav-item">4.2 Playbooks</a>
                        <a href="4-3-apps-integrations.html" class="nav-item">4.3 Apps & Integrations</a>
                        <a href="4-4-case-management.html" class="nav-item">4.4 Case Management</a>
                    </div>
                </div>
                
                <!-- Section 5: Microsoft Sentinel Fundamentals -->
                <div class="nav-section expanded">
                    <div class="nav-section-header">
                        <span class="nav-section-title">
                            <span class="nav-section-icon">ğŸ”·</span>
                            <span>Sentinel Fundamentals</span>
                        </span>
                        <span class="nav-section-arrow">â–¶</span>
                    </div>
                    <div class="nav-section-items">
                        <a href="5-1-sentinel-architecture.html" class="nav-item">5.1 Sentinel Architecture</a>
                        <a href="5-2-log-analytics.html" class="nav-item">5.2 Log Analytics Workspace</a>
                        <a href="5-3-data-connectors.html" class="nav-item active">5.3 Data Connectors</a>
                        <a href="5-4-kql-fundamentals.html" class="nav-item">5.4 KQL Fundamentals</a>
                        <a href="5-5-kql-advanced.html" class="nav-item">5.5 KQL Advanced</a>
                        <a href="5-6-analytics-rules.html" class="nav-item">5.6 Analytics Rules</a>
                        <a href="5-7-incidents-investigation.html" class="nav-item">5.7 Incidents & Investigation</a>
                        <a href="5-8-workbooks-reporting.html" class="nav-item">5.8 Workbooks & Reporting</a>
                    </div>
                </div>
                
                <!-- Section 6: Sentinel Security Operations -->
                <div class="nav-section">
                    <div class="nav-section-header">
                        <span class="nav-section-title">
                            <span class="nav-section-icon">ğŸ”¶</span>
                            <span>Sentinel Security Ops</span>
                        </span>
                        <span class="nav-section-arrow">â–¶</span>
                    </div>
                    <div class="nav-section-items">
                        <a href="6-1-automation-playbooks.html" class="nav-item">6.1 Automation & Playbooks</a>
                        <a href="6-2-watchlists-ti.html" class="nav-item">6.2 Watchlists & Threat Intel</a>
                        <a href="6-3-ueba.html" class="nav-item">6.3 UEBA</a>
                        <a href="6-4-sentinel-administration.html" class="nav-item">6.4 Sentinel Administration</a>
                    </div>
                </div>
                
                <!-- Section 7: SIEM Comparison -->
                <div class="nav-section">
                    <div class="nav-section-header">
                        <span class="nav-section-title">
                            <span class="nav-section-icon">ğŸ”€</span>
                            <span>SIEM Comparison</span>
                        </span>
                        <span class="nav-section-arrow">â–¶</span>
                    </div>
                    <div class="nav-section-items">
                        <a href="7-1-splunk-vs-sentinel.html" class="nav-item">7.1 Splunk vs Sentinel</a>
                        <a href="7-2-query-language-comparison.html" class="nav-item">7.2 SPL vs KQL</a>
                        <a href="7-3-migration-considerations.html" class="nav-item">7.3 Migration Guide</a>
                    </div>
                </div>
                
                <!-- Section 8: Detection Engineering -->
                <div class="nav-section">
                    <div class="nav-section-header">
                        <span class="nav-section-title">
                            <span class="nav-section-icon">ğŸ¯</span>
                            <span>Detection Engineering</span>
                        </span>
                        <span class="nav-section-arrow">â–¶</span>
                    </div>
                    <div class="nav-section-items">
                        <a href="8-1-detection-development.html" class="nav-item">8.1 Detection Development</a>
                        <a href="8-2-mitre-attack.html" class="nav-item">8.2 MITRE ATT&CK</a>
                        <a href="8-3-sigma-rules.html" class="nav-item">8.3 SIGMA Rules</a>
                        <a href="8-4-detection-testing.html" class="nav-item">8.4 Testing & Validation</a>
                    </div>
                </div>
                
                <!-- Section 9: Threat Hunting -->
                <div class="nav-section">
                    <div class="nav-section-header">
                        <span class="nav-section-title">
                            <span class="nav-section-icon">ğŸ”</span>
                            <span>Threat Hunting</span>
                        </span>
                        <span class="nav-section-arrow">â–¶</span>
                    </div>
                    <div class="nav-section-items">
                        <a href="9-1-hunting-fundamentals.html" class="nav-item">9.1 Hunting Fundamentals</a>
                        <a href="9-2-hunting-methodologies.html" class="nav-item">9.2 Hunting Methodologies</a>
                        <a href="9-3-hunting-queries.html" class="nav-item">9.3 Hunting Queries</a>
                    </div>
                </div>
                
                <!-- Section 10: Use Case Library -->
                <div class="nav-section">
                    <div class="nav-section-header">
                        <span class="nav-section-title">
                            <span class="nav-section-icon">ğŸ“</span>
                            <span>Use Case Library</span>
                        </span>
                        <span class="nav-section-arrow">â–¶</span>
                    </div>
                    <div class="nav-section-items">
                        <a href="10-1-authentication-attacks.html" class="nav-item">10.1 Authentication Attacks</a>
                        <a href="10-2-malware-execution.html" class="nav-item">10.2 Malware & Execution</a>
                        <a href="10-3-data-exfiltration.html" class="nav-item">10.3 Data Exfiltration</a>
                        <a href="10-4-insider-threats.html" class="nav-item">10.4 Insider Threats</a>
                    </div>
                </div>
                <!-- Appendices -->
                <div class="nav-section">
                    <div class="nav-section-header">
                        <span class="nav-section-title">
                            <span class="nav-section-icon">ğŸ“–</span>
                            <span>Appendices</span>
                        </span>
                        <span class="nav-section-arrow">â–¶</span>
                    </div>
                    <div class="nav-section-items">
                        <a href="a-1-windows-security-fundamentals.html" class="nav-item">A.1 Windows Security</a>
                        <a href="a-2-network-fundamentals.html" class="nav-item">A.2 Network Fundamentals</a>
                        <a href="a-3-use-case-development.html" class="nav-item">A.3 Use Case Development</a>
                        <a href="a-4-siem-migration-guide.html" class="nav-item">A.4 SIEM Migration Guide</a>
                        <a href="a-5-siem-design-from-scratch.html" class="nav-item">A.5 Design from Scratch</a>
                    </div>
                </div>
            </nav>
            
            <div class="sidebar-footer">
                <p>Built for Security Engineers</p>
            </div>
        </aside>
        
        <main class="main-content">
            <header class="content-header">
                <nav class="breadcrumb">
                    <a href="index.html">Home</a>
                    <span class="breadcrumb-separator">/</span>
                    <a href="5-1-sentinel-architecture.html">Sentinel Fundamentals</a>
                    <span class="breadcrumb-separator">/</span>
                    <span class="breadcrumb-current">Data Connectors</span>
                </nav>
            </header>
            
            <div class="content-area">
                <h1 class="page-title">Data Connectors</h1>
                <p class="page-subtitle">Connecting Microsoft and third-party data sources to Sentinel</p>
                
                <div class="info-box overview">
                    <div class="info-box-header">
                        <span class="info-box-icon">ğŸ“˜</span>
                        Chapter Overview
                    </div>
                    <div class="info-box-content">
                        <p>
                            Data connectors bring security data into Microsoft Sentinel. This chapter covers connector types, key Microsoft integrations, third-party connectors, and custom ingestion methods.
                        </p>
                    </div>
                </div>
                
                <h2 id="connector-types">Connector Types</h2>
                
                <pre><code class="language-text">DATA CONNECTOR CATEGORIES:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              SERVICE-TO-SERVICE                         â”‚
â”‚  â€¢ Native Microsoft connectors                         â”‚
â”‚  â€¢ API-based integration                               â”‚
â”‚  â€¢ No agent required                                   â”‚
â”‚  Examples: Azure AD, M365, Defender products           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              AGENT-BASED                                â”‚
â”‚  â€¢ Azure Monitor Agent (AMA) - recommended             â”‚
â”‚  â€¢ Log Analytics Agent (MMA) - legacy                  â”‚
â”‚  â€¢ Installed on source system                          â”‚
â”‚  Examples: Windows Events, Syslog, CEF                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              API / WEBHOOK                              â”‚
â”‚  â€¢ REST API ingestion                                  â”‚
â”‚  â€¢ Logic Apps / Functions                              â”‚
â”‚  â€¢ Custom connectors                                   â”‚
â”‚  Examples: Third-party SaaS, custom apps               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              SYSLOG / CEF                               â”‚
â”‚  â€¢ Standard log forwarding                             â”‚
â”‚  â€¢ Via Log Forwarder VM                               â”‚
â”‚  Examples: Firewalls, network devices, Linux           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</code></pre>
                
                <h2 id="microsoft-connectors">Microsoft Data Connectors</h2>
                
                <h3>Free Connectors</h3>
                
                <div class="table-wrapper">
                    <table>
                        <thead>
                            <tr>
                                <th>Connector</th>
                                <th>Data Type</th>
                                <th>Table</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Azure Activity</strong></td>
                                <td>Azure management events</td>
                                <td>AzureActivity</td>
                            </tr>
                            <tr>
                                <td><strong>Microsoft Defender XDR</strong></td>
                                <td>Alerts and incidents</td>
                                <td>SecurityAlert, SecurityIncident</td>
                            </tr>
                            <tr>
                                <td><strong>Microsoft Defender for Cloud</strong></td>
                                <td>Security recommendations, alerts</td>
                                <td>SecurityAlert</td>
                            </tr>
                            <tr>
                                <td><strong>Office 365</strong></td>
                                <td>Audit logs (basic)</td>
                                <td>OfficeActivity</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <h3>Premium Connectors</h3>
                
                <div class="table-wrapper">
                    <table>
                        <thead>
                            <tr>
                                <th>Connector</th>
                                <th>Data Type</th>
                                <th>Table</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Azure AD / Entra ID</strong></td>
                                <td>Sign-in logs, audit logs</td>
                                <td>SigninLogs, AuditLogs</td>
                            </tr>
                            <tr>
                                <td><strong>Microsoft Defender for Endpoint</strong></td>
                                <td>Device events, alerts</td>
                                <td>DeviceEvents, DeviceProcessEvents</td>
                            </tr>
                            <tr>
                                <td><strong>Microsoft Defender for Identity</strong></td>
                                <td>Identity threats</td>
                                <td>IdentityDirectoryEvents</td>
                            </tr>
                            <tr>
                                <td><strong>Microsoft Defender for Cloud Apps</strong></td>
                                <td>Cloud app activity</td>
                                <td>McasShadowItReporting</td>
                            </tr>
                            <tr>
                                <td><strong>Microsoft Defender for Office 365</strong></td>
                                <td>Email security events</td>
                                <td>EmailEvents, EmailUrlInfo</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <h3>Enabling Microsoft Connectors</h3>
                
                <pre><code class="language-text">ENABLING AZURE AD CONNECTOR:

1. Navigate to Sentinel â†’ Data connectors
2. Search for "Azure Active Directory"
3. Click connector â†’ Open connector page
4. Prerequisites:
   â€¢ Global Admin or Security Admin role
   â€¢ Azure AD Premium P1/P2 license
5. Configuration:
   â€¢ Select log types:
     â˜‘ Sign-in logs
     â˜‘ Audit logs
     â˜‘ Non-interactive sign-in logs
     â˜‘ Service principal sign-in logs
     â˜‘ Managed identity sign-in logs
     â˜‘ Provisioning logs
6. Click "Connect"</code></pre>
                
                <h2 id="third-party">Third-Party Connectors</h2>
                
                <h3>CEF/Syslog Architecture</h3>
                
                <pre><code class="language-text">CEF/SYSLOG FORWARDING:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   FIREWALL      â”‚     â”‚  LOG FORWARDER  â”‚     â”‚    SENTINEL     â”‚
â”‚   (Palo Alto)   â”‚â”€â”€â”€â”€â–ºâ”‚      VM         â”‚â”€â”€â”€â”€â–ºâ”‚   WORKSPACE     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚                 â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚  â€¢ rsyslog      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚  â€¢ AMA Agent    â”‚
â”‚     IDS/IPS     â”‚â”€â”€â”€â”€â–ºâ”‚  â€¢ DCR          â”‚
â”‚    (Snort)      â”‚     â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

PORT: 514 (UDP/TCP) or 6514 (TLS)</code></pre>
                
                <h3>Log Forwarder Setup</h3>
                
                <pre><code class="language-bash"># Deploy Linux VM as log forwarder
# Install Azure Monitor Agent (AMA)

# Configure rsyslog to receive logs
sudo vi /etc/rsyslog.conf

# Enable UDP syslog reception
module(load="imudp")
input(type="imudp" port="514")

# Enable TCP syslog reception  
module(load="imtcp")
input(type="imtcp" port="514")

# Restart rsyslog
sudo systemctl restart rsyslog

# Verify listening
sudo netstat -tulpn | grep 514</code></pre>
                
                <h3>Common Third-Party Connectors</h3>
                
                <div class="table-wrapper">
                    <table>
                        <thead>
                            <tr>
                                <th>Category</th>
                                <th>Products</th>
                                <th>Method</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Firewalls</strong></td>
                                <td>Palo Alto, Fortinet, Cisco ASA, Check Point</td>
                                <td>CEF over Syslog</td>
                            </tr>
                            <tr>
                                <td><strong>EDR</strong></td>
                                <td>CrowdStrike, Carbon Black, SentinelOne</td>
                                <td>API / Data connector</td>
                            </tr>
                            <tr>
                                <td><strong>Cloud</strong></td>
                                <td>AWS, GCP, Okta, Salesforce</td>
                                <td>API / Logic Apps</td>
                            </tr>
                            <tr>
                                <td><strong>Network</strong></td>
                                <td>Zscaler, Netskope, F5</td>
                                <td>CEF / API</td>
                            </tr>
                            <tr>
                                <td><strong>Vulnerability</strong></td>
                                <td>Qualys, Tenable, Rapid7</td>
                                <td>API connector</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <h2 id="windows-events">Windows Event Collection</h2>
                
                <pre><code class="language-text">WINDOWS EVENT COLLECTION OPTIONS:

1. AZURE MONITOR AGENT (AMA) - Recommended
   â€¢ Modern agent architecture
   â€¢ Data Collection Rules (DCR)
   â€¢ Filter at source
   â€¢ Table: SecurityEvent or WindowsEvent

2. LEGACY LOG ANALYTICS AGENT (MMA)
   â€¢ Being deprecated
   â€¢ Workspace-level configuration
   â€¢ Table: SecurityEvent

AMA CONFIGURATION:
â€¢ Create Data Collection Rule
â€¢ Select event types:
  - Security (audit events)
  - Application
  - System
â€¢ Filter by Event IDs (recommended):
  - 4624, 4625 (logons)
  - 4688 (process creation)
  - 4672 (special privileges)
  - 4720-4767 (account management)</code></pre>
                
                <h3>Security Event Filtering</h3>
                
                <pre><code class="language-text">RECOMMENDED SECURITY EVENTS:

Authentication:
4624 - Successful logon
4625 - Failed logon
4634 - Logoff
4648 - Explicit credential logon
4672 - Special privileges assigned

Account Management:
4720 - User account created
4722 - User account enabled
4724 - Password reset attempt
4728 - Member added to security group
4732 - Member added to local group

Process Tracking:
4688 - Process creation
4689 - Process termination

Object Access:
4663 - Object access attempt
4670 - Permissions changed

Policy Changes:
4719 - System audit policy changed
4739 - Domain policy changed</code></pre>
                
                <h2 id="custom-ingestion">Custom Data Ingestion</h2>
                
                <h3>REST API (Data Collector API)</h3>
                
                <pre><code class="language-python"># Python example - Send custom logs to Sentinel
import requests
import datetime
import hashlib
import hmac
import base64

workspace_id = "your-workspace-id"
shared_key = "your-shared-key"
log_type = "CustomSecurityLog"

def build_signature(date, content_length, method, content_type, resource):
    x_headers = f'x-ms-date:{date}'
    string_to_hash = f'{method}\n{content_length}\n{content_type}\n{x_headers}\n{resource}'
    bytes_to_hash = bytes(string_to_hash, encoding="utf-8")
    decoded_key = base64.b64decode(shared_key)
    encoded_hash = base64.b64encode(
        hmac.new(decoded_key, bytes_to_hash, digestmod=hashlib.sha256).digest()
    ).decode()
    return f'SharedKey {workspace_id}:{encoded_hash}'

def post_data(body):
    method = 'POST'
    content_type = 'application/json'
    resource = '/api/logs'
    rfc1123date = datetime.datetime.utcnow().strftime('%a, %d %b %Y %H:%M:%S GMT')
    content_length = len(body)
    signature = build_signature(rfc1123date, content_length, method, content_type, resource)
    
    uri = f'https://{workspace_id}.ods.opinsights.azure.com{resource}?api-version=2016-04-01'
    
    headers = {
        'content-type': content_type,
        'Authorization': signature,
        'Log-Type': log_type,
        'x-ms-date': rfc1123date
    }
    
    response = requests.post(uri, data=body, headers=headers)
    return response.status_code

# Send data
import json
log_data = json.dumps([{
    "EventTime": datetime.datetime.utcnow().isoformat(),
    "SourceIP": "192.168.1.50",
    "Action": "blocked",
    "User": "admin"
}])

status = post_data(log_data)
print(f"Status: {status}")</code></pre>
                
                <h3>Logic Apps Connector</h3>
                
                <pre><code class="language-text">LOGIC APP FOR CUSTOM INGESTION:

1. Create Logic App
2. Add trigger (HTTP, Schedule, Event Grid, etc.)
3. Add action: "Send Data" (Azure Log Analytics Data Collector)
4. Configure:
   â€¢ Workspace ID
   â€¢ Workspace Key
   â€¢ JSON body
   â€¢ Custom log type name

USE CASES:
â€¢ Ingest from REST APIs
â€¢ Scheduled data pulls
â€¢ Webhook receivers
â€¢ File processing (blob trigger)</code></pre>
                
                <h2 id="verifying">Verifying Data Ingestion</h2>
                
                <pre><code class="language-kql">// Check if data is flowing for a connector
SigninLogs
| where TimeGenerated > ago(1h)
| summarize count() by bin(TimeGenerated, 5m)
| render timechart

// Check all tables for recent data
search *
| where TimeGenerated > ago(1h)
| summarize count() by $table
| sort by count_ desc

// Verify specific connector - Azure AD
SigninLogs
| where TimeGenerated > ago(24h)
| summarize 
    Records = count(),
    FirstEvent = min(TimeGenerated),
    LastEvent = max(TimeGenerated)

// Check for ingestion delay
SecurityEvent
| where TimeGenerated > ago(1h)
| extend IngestionDelay = ingestion_time() - TimeGenerated
| summarize avg(IngestionDelay), max(IngestionDelay)

// Heartbeat check for agents
Heartbeat
| where TimeGenerated > ago(1h)
| summarize LastHeartbeat = max(TimeGenerated) by Computer
| where LastHeartbeat < ago(15m)</code></pre>
                
                <div class="info-box best-practice">
                    <div class="info-box-header">
                        <span class="info-box-icon">âœ“</span>
                        Data Connector Best Practices
                    </div>
                    <div class="info-box-content">
                        <p>
                            <strong>Prioritization:</strong><br>
                            â–¡ Start with free connectors (Azure Activity, Defender alerts)<br>
                            â–¡ Enable Azure AD for identity visibility<br>
                            â–¡ Connect Defender products for endpoint/email<br>
                            â–¡ Add network security (firewalls) for perimeter visibility<br><br>
                            
                            <strong>Operations:</strong><br>
                            â–¡ Monitor connector health in Data connectors page<br>
                            â–¡ Set up alerts for ingestion failures<br>
                            â–¡ Filter events at source to reduce costs<br>
                            â–¡ Use AMA instead of legacy MMA agent
                        </p>
                    </div>
                </div>
                
                <div class="info-box interview">
                    <div class="info-box-header">
                        <span class="info-box-icon">ğŸ’¼</span>
                        Interview Question
                    </div>
                    <div class="info-box-content">
                        <p>
                            <strong>"How would you onboard a new data source to Microsoft Sentinel?"</strong><br><br>
                            <strong>1. Identify connector type:</strong> Check if built-in connector exists in Content Hub<br>
                            <strong>2. Check prerequisites:</strong> Licenses, permissions, network connectivity<br>
                            <strong>3. Deploy connector:</strong><br>
                            - Microsoft sources: Enable in Data connectors page<br>
                            - CEF/Syslog: Deploy log forwarder VM with AMA<br>
                            - API-based: Configure authentication and Logic App<br>
                            <strong>4. Verify ingestion:</strong> Query the target table to confirm data flow<br>
                            <strong>5. Enable content:</strong> Install related analytics rules and workbooks from Content Hub<br>
                            <strong>6. Monitor:</strong> Set up health monitoring for the connector
                        </p>
                    </div>
                </div>
                
                <h2 id="summary">Chapter Summary</h2>
                
                <ul>
                    <li>Connectors: Service-to-service, agent-based, API, Syslog/CEF</li>
                    <li>Free: Azure Activity, Defender XDR alerts, basic O365</li>
                    <li>Premium: Azure AD logs, Defender raw events</li>
                    <li>CEF/Syslog requires log forwarder VM with AMA</li>
                    <li>Use Data Collection Rules to filter at ingestion</li>
                    <li>Custom data via REST API or Logic Apps</li>
                    <li>Verify ingestion with KQL queries</li>
                </ul>
                
                <div class="page-navigation">
                    <a href="5-2-log-analytics.html" class="nav-button prev">
                        <span class="nav-button-icon">â†</span>
                        <div>
                            <span class="nav-button-label">Previous</span>
                            <span class="nav-button-title">Log Analytics Workspace</span>
                        </div>
                    </a>
                    <a href="5-4-kql-fundamentals.html" class="nav-button next">
                        <span class="nav-button-icon">â†’</span>
                        <div>
                            <span class="nav-button-label">Next</span>
                            <span class="nav-button-title">KQL Fundamentals</span>
                        </div>
                    </a>
                </div>
            </div>
        </main>
    </div>
    
    <script src="main.js"></script>
</body>
</html>
