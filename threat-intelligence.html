<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Threat Intelligence - Microsoft Sentinel Guide</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <nav class="navbar">
        <a href="index.html" class="navbar-brand">
            <svg viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>
            </svg>
            Sentinel Guide
        </a>
        <ul class="navbar-nav">
            <li><a href="index.html">Home</a></li>
            <li><a href="architecture.html">Architecture</a></li>
            <li><a href="analytics-rules.html">Analytics</a></li>
            <li><a href="automation.html">Automation</a></li>
        </ul>
        <button class="mobile-toggle" aria-label="Toggle menu">
            <svg viewBox="0 0 24 24" fill="none">
                <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
            </svg>
        </button>
    </nav>

    <aside class="sidebar">
        <div class="sidebar-section">
            <div class="sidebar-title">Getting Started</div>
            <ul class="sidebar-nav">
                <li><a href="index.html">Home</a></li>
                <li><a href="architecture.html">Architecture</a></li>
            </ul>
        </div>
        <div class="sidebar-section">
            <div class="sidebar-title">Detection & Analytics</div>
            <ul class="sidebar-nav">
                <li><a href="analytics-rules.html">Analytics Rules</a></li>
                <li><a href="connector-rules.html">Connector Rules</a></li>
                <li><a href="correlation-rules.html">Correlation Rules</a></li>
                <li><a href="kql-library.html">KQL Library</a></li>
            </ul>
        </div>
        <div class="sidebar-section">
            <div class="sidebar-title">Investigation & Response</div>
            <ul class="sidebar-nav">
                <li><a href="incidents.html">Incidents</a></li>
                <li><a href="automation.html">Automation & SOAR</a></li>
            </ul>
        </div>
        <div class="sidebar-section">
            <div class="sidebar-title">Intelligence & Analytics</div>
            <ul class="sidebar-nav">
                <li><a href="workbooks.html">Workbooks</a></li>
                <li><a href="threat-intelligence.html" class="active">Threat Intelligence</a></li>
                <li><a href="ueba.html">UEBA</a></li>
            </ul>
        </div>
        <div class="sidebar-section">
            <div class="sidebar-title">Management</div>
            <ul class="sidebar-nav">
                <li><a href="content-hub.html">Content Hub</a></li>
                <li><a href="costs.html">Pricing & Costs</a></li>
                <li><a href="best-practices.html">Best Practices</a></li>
            </ul>
        </div>
        <div class="sidebar-section">
            <div class="sidebar-title">Quick Resources</div>
            <ul class="sidebar-nav">
                <li><a href="kql-cheatsheet.html">KQL Cheat Sheet</a></li>
                <li><a href="deployment-checklist.html">Deployment Checklist</a></li>
                <li><a href="interview-prep.html">Interview Prep</a></li>
            </ul>
        </div>
    </aside>

    <main class="main-content">
        <div class="content-container">
            <h1>Threat Intelligence</h1>
            <p>Integrate threat intelligence feeds, manage indicators of compromise (IOCs), and automate threat detection using STIX/TAXII standards and Microsoft's native TI platform.</p>

            <div class="toc">
                <div class="toc-title">On This Page</div>
                <ul class="toc-list">
                    <li><a href="#overview">TI Overview</a></li>
                    <li><a href="#architecture">Architecture & Data Flow</a></li>
                    <li><a href="#sources">TI Sources</a></li>
                    <li><a href="#indicator-types">Indicator Types</a></li>
                    <li><a href="#taxii">TAXII/STIX Configuration</a></li>
                    <li><a href="#api">Graph API Integration</a></li>
                    <li><a href="#matching">IOC Matching Rules</a></li>
                    <li><a href="#tables">TI Tables</a></li>
                    <li><a href="#queries">TI Queries</a></li>
                    <li><a href="#lifecycle">Indicator Lifecycle</a></li>
                    <li><a href="#workbooks">TI Workbooks</a></li>
                    <li><a href="#best-practices">Best Practices</a></li>
                </ul>
            </div>

            <h2 id="overview">TI Overview</h2>
            <p>Threat Intelligence in Microsoft Sentinel enables detection of known threats by matching network traffic, authentication events, and endpoint data against indicators of compromise (IOCs).</p>

            <div class="card-grid">
                <div class="card">
                    <div class="card-title">ğŸ¯ IOC Matching</div>
                    <div class="card-body">
                        <p>Automatically match IPs, domains, URLs, and file hashes against threat intelligence indicators.</p>
                    </div>
                </div>
                <div class="card">
                    <div class="card-title">ğŸ“¡ Multiple Sources</div>
                    <div class="card-body">
                        <p>Integrate Microsoft Defender TI, TAXII feeds, MISP, and custom sources via API.</p>
                    </div>
                </div>
                <div class="card">
                    <div class="card-title">ğŸ”„ Automated Updates</div>
                    <div class="card-body">
                        <p>Continuous indicator ingestion with automatic expiration and lifecycle management.</p>
                    </div>
                </div>
                <div class="card">
                    <div class="card-title">ğŸ“Š Investigation Context</div>
                    <div class="card-body">
                        <p>Enrich incidents with TI context including threat actor attribution and campaign details.</p>
                    </div>
                </div>
            </div>

            <h2 id="architecture">Architecture & Data Flow</h2>

            <div class="ascii-diagram">
<pre>
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    THREAT INTELLIGENCE ARCHITECTURE                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                  â”‚
â”‚   THREAT INTELLIGENCE SOURCES                                                    â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                    â”‚
â”‚                                                                                  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚   â”‚   MICROSOFT     â”‚  â”‚  TAXII FEEDS    â”‚  â”‚   CUSTOM API    â”‚                â”‚
â”‚   â”‚  DEFENDER TI    â”‚  â”‚                 â”‚  â”‚                 â”‚                â”‚
â”‚   â”‚                 â”‚  â”‚  â€¢ AlienVault   â”‚  â”‚  â€¢ MISP         â”‚                â”‚
â”‚   â”‚  â€¢ Native       â”‚  â”‚  â€¢ Anomali      â”‚  â”‚  â€¢ Custom       â”‚                â”‚
â”‚   â”‚  â€¢ E5 included  â”‚  â”‚  â€¢ ISAC feeds   â”‚  â”‚  â€¢ Graph API    â”‚                â”‚
â”‚   â”‚  â€¢ Premium TI   â”‚  â”‚  â€¢ FS-ISAC      â”‚  â”‚  â€¢ Playbooks    â”‚                â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚            â”‚                    â”‚                    â”‚                          â”‚
â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚                                 â”‚                                                â”‚
â”‚                                 â–¼                                                â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                    SENTINEL TI PLATFORM                                  â”‚   â”‚
â”‚   â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                  â”‚   â”‚
â”‚   â”‚                                                                          â”‚   â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚   â”‚   â”‚            ThreatIntelligenceIndicator Table                     â”‚   â”‚   â”‚
â”‚   â”‚   â”‚                                                                  â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   Indicator Types:                 Metadata:                     â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â€¢ IP Addresses (v4/v6)          â€¢ Confidence (0-100)          â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â€¢ Domain Names                  â€¢ TLP Level                    â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â€¢ URLs                          â€¢ Threat Type                  â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â€¢ File Hashes (MD5/SHA1/SHA256) â€¢ Description                  â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â€¢ Email Addresses               â€¢ Kill Chain Phase             â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â€¢ Email Subjects                â€¢ Expiration Date              â”‚   â”‚   â”‚
â”‚   â”‚   â”‚                                                                  â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚   â”‚                                                                          â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                 â”‚                                                â”‚
â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚            â”‚                    â”‚                    â”‚                          â”‚
â”‚            â–¼                    â–¼                    â–¼                          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚   â”‚ ANALYTICS RULES â”‚  â”‚  INVESTIGATION  â”‚  â”‚   WORKBOOKS     â”‚                â”‚
â”‚   â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚  â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚  â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚                â”‚
â”‚   â”‚                 â”‚  â”‚                 â”‚  â”‚                 â”‚                â”‚
â”‚   â”‚ TI Map queries  â”‚  â”‚ Entity pages    â”‚  â”‚ TI Overview     â”‚                â”‚
â”‚   â”‚ join to logs:   â”‚  â”‚ show TI matches â”‚  â”‚ dashboards      â”‚                â”‚
â”‚   â”‚ â€¢ Network logs  â”‚  â”‚ for IPs, hosts, â”‚  â”‚ with metrics    â”‚                â”‚
â”‚   â”‚ â€¢ DNS logs      â”‚  â”‚ and file hashes â”‚  â”‚ and trends      â”‚                â”‚
â”‚   â”‚ â€¢ File events   â”‚  â”‚                 â”‚  â”‚                 â”‚                â”‚
â”‚   â”‚ â€¢ Auth logs     â”‚  â”‚                 â”‚  â”‚                 â”‚                â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                                                                  â”‚
â”‚   DATA SOURCES TO MATCH AGAINST:                                                â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                â”‚
â”‚   CommonSecurityLog (firewall)  â”‚  DnsEvents          â”‚  DeviceNetworkEvents   â”‚
â”‚   DeviceFileEvents              â”‚  SigninLogs         â”‚  AzureActivity         â”‚
â”‚   OfficeActivity                â”‚  EmailEvents        â”‚  Custom logs           â”‚
â”‚                                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</pre>
            </div>

            <h2 id="sources">TI Sources</h2>

            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Source</th>
                            <th>Connection Method</th>
                            <th>Cost</th>
                            <th>Indicator Types</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Microsoft Defender TI</strong></td>
                            <td>Native connector</td>
                            <td>Included with E5 / Premium add-on</td>
                            <td>IP, Domain, URL, Hash, Email</td>
                        </tr>
                        <tr>
                            <td><strong>TAXII 2.x Feeds</strong></td>
                            <td>TAXII connector</td>
                            <td>Varies by provider</td>
                            <td>All STIX 2.x indicator types</td>
                        </tr>
                        <tr>
                            <td><strong>MISP</strong></td>
                            <td>Playbook / API</td>
                            <td>Free (self-hosted)</td>
                            <td>All types + custom attributes</td>
                        </tr>
                        <tr>
                            <td><strong>AlienVault OTX</strong></td>
                            <td>TAXII / API</td>
                            <td>Free tier available</td>
                            <td>IP, Domain, Hash, URL</td>
                        </tr>
                        <tr>
                            <td><strong>Anomali ThreatStream</strong></td>
                            <td>TAXII / API</td>
                            <td>Commercial</td>
                            <td>All types + enrichment</td>
                        </tr>
                        <tr>
                            <td><strong>FS-ISAC</strong></td>
                            <td>TAXII</td>
                            <td>Membership required</td>
                            <td>Financial sector IOCs</td>
                        </tr>
                        <tr>
                            <td><strong>Graph Security API</strong></td>
                            <td>Custom connector</td>
                            <td>Development effort</td>
                            <td>Any custom format</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <h2 id="indicator-types">Indicator Types</h2>

            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Type</th>
                            <th>STIX Pattern Example</th>
                            <th>Use Case</th>
                            <th>Tables to Match</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>IPv4/IPv6</strong></td>
                            <td>[ipv4-addr:value = '192.168.1.1']</td>
                            <td>C2 servers, malicious IPs</td>
                            <td>CommonSecurityLog, DeviceNetworkEvents</td>
                        </tr>
                        <tr>
                            <td><strong>Domain</strong></td>
                            <td>[domain-name:value = 'evil.com']</td>
                            <td>Phishing, malware domains</td>
                            <td>DnsEvents, DeviceNetworkEvents</td>
                        </tr>
                        <tr>
                            <td><strong>URL</strong></td>
                            <td>[url:value = 'http://evil.com/payload']</td>
                            <td>Malware delivery, phishing</td>
                            <td>DeviceNetworkEvents, OfficeActivity</td>
                        </tr>
                        <tr>
                            <td><strong>File Hash (SHA256)</strong></td>
                            <td>[file:hashes.SHA-256 = 'abc123...']</td>
                            <td>Malware detection</td>
                            <td>DeviceFileEvents, DeviceProcessEvents</td>
                        </tr>
                        <tr>
                            <td><strong>File Hash (MD5)</strong></td>
                            <td>[file:hashes.MD5 = 'abc123...']</td>
                            <td>Legacy malware detection</td>
                            <td>DeviceFileEvents, CommonSecurityLog</td>
                        </tr>
                        <tr>
                            <td><strong>Email Address</strong></td>
                            <td>[email-addr:value = 'bad@evil.com']</td>
                            <td>Phishing sender detection</td>
                            <td>EmailEvents, OfficeActivity</td>
                        </tr>
                        <tr>
                            <td><strong>Email Subject</strong></td>
                            <td>[email-message:subject = 'Invoice']</td>
                            <td>Campaign detection</td>
                            <td>EmailEvents</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <h3>Traffic Light Protocol (TLP)</h3>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>TLP Level</th>
                            <th>Color</th>
                            <th>Sharing Restrictions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>TLP:CLEAR</strong></td>
                            <td>âšª White</td>
                            <td>Unlimited sharing</td>
                        </tr>
                        <tr>
                            <td><strong>TLP:GREEN</strong></td>
                            <td>ğŸŸ¢ Green</td>
                            <td>Share within community, not publicly</td>
                        </tr>
                        <tr>
                            <td><strong>TLP:AMBER</strong></td>
                            <td>ğŸŸ¡ Amber</td>
                            <td>Limited sharing within organization</td>
                        </tr>
                        <tr>
                            <td><strong>TLP:AMBER+STRICT</strong></td>
                            <td>ğŸŸ  Amber+Strict</td>
                            <td>Share only with need-to-know</td>
                        </tr>
                        <tr>
                            <td><strong>TLP:RED</strong></td>
                            <td>ğŸ”´ Red</td>
                            <td>No sharing outside original recipients</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <h2 id="taxii">TAXII/STIX Configuration</h2>
            <p>Configure TAXII 2.x feeds to ingest threat intelligence indicators.</p>

            <h3>TAXII Connector Setup</h3>
            <div class="accordion">
                <div class="accordion-item">
                    <button class="accordion-header">
                        Step 1: Navigate to Data Connectors
                        <svg class="accordion-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"/></svg>
                    </button>
                    <div class="accordion-content">
                        <p><strong>Path:</strong> Microsoft Sentinel â†’ Data connectors â†’ Search "Threat Intelligence - TAXII"</p>
                        <p>Click "Open connector page" to configure.</p>
                    </div>
                </div>
                <div class="accordion-item">
                    <button class="accordion-header">
                        Step 2: Add TAXII Server
                        <svg class="accordion-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"/></svg>
                    </button>
                    <div class="accordion-content">
                        <p>Click "Add TAXII 2.0/2.1 server" and provide:</p>
                        <ul>
                            <li><strong>Friendly name:</strong> Descriptive name (e.g., "AlienVault OTX")</li>
                            <li><strong>API root URL:</strong> TAXII server endpoint</li>
                            <li><strong>Collection ID:</strong> Specific collection to subscribe</li>
                            <li><strong>Username/Password:</strong> If authentication required</li>
                            <li><strong>Polling frequency:</strong> How often to check for updates</li>
                        </ul>
                    </div>
                </div>
                <div class="accordion-item">
                    <button class="accordion-header">
                        Step 3: Configure Polling
                        <svg class="accordion-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"/></svg>
                    </button>
                    <div class="accordion-content">
                        <p>Set polling schedule based on feed update frequency:</p>
                        <ul>
                            <li><strong>High-frequency feeds:</strong> Every 1 hour</li>
                            <li><strong>Standard feeds:</strong> Every 24 hours</li>
                            <li><strong>Initial import:</strong> May take time for large collections</li>
                        </ul>
                    </div>
                </div>
            </div>

            <h3>Common TAXII Feeds</h3>
            <div class="code-block">
                <div class="code-header">
                    <span class="code-lang">TAXII Configuration Examples</span>
                    <button class="copy-btn">Copy</button>
                </div>
                <div class="code-content">
<pre># AlienVault OTX (Free)
API Root: https://otx.alienvault.com/taxii/
Collection: Insert your subscribed collection ID
Auth: API key in header

# Anomali Limo (Free tier)
API Root: https://limo.anomali.com/api/v1/taxii2/
Discovery: https://limo.anomali.com/api/v1/taxii2/taxii/
Collections: Multiple available (ransomware, phishing, etc.)
Auth: Basic auth with Anomali account

# FS-ISAC (Members only)
API Root: Provided upon membership
Auth: Certificate-based</pre>
                </div>
            </div>

            <h2 id="api">Graph API Integration</h2>
            <p>Upload custom indicators using Microsoft Graph Security API.</p>

            <h3>PowerShell Upload Example</h3>
            <div class="code-block">
                <div class="code-header">
                    <span class="code-lang">PowerShell - Upload IP Indicator</span>
                    <button class="copy-btn">Copy</button>
                </div>
                <div class="code-content">
<pre># Get access token
$tenantId = "your-tenant-id"
$clientId = "your-app-id"
$clientSecret = "your-secret"

$tokenBody = @{
    Grant_Type    = "client_credentials"
    Scope         = "https://graph.microsoft.com/.default"
    Client_Id     = $clientId
    Client_Secret = $clientSecret
}

$tokenResponse = Invoke-RestMethod -Uri "https://login.microsoftonline.com/$tenantId/oauth2/v2.0/token" -Method POST -Body $tokenBody
$accessToken = $tokenResponse.access_token

# Create indicator
$indicator = @{
    action                  = "alert"
    activityGroupNames      = @("APT29")
    confidence              = 85
    description             = "Known C2 server for APT29"
    expirationDateTime      = (Get-Date).AddDays(30).ToString("yyyy-MM-ddTHH:mm:ssZ")
    externalId              = "TI-" + (New-Guid).ToString()
    killChain               = @(
        @{
            name = "C2"
        }
    )
    malwareFamilyNames      = @("CozyDuke")
    networkDestinationIPv4  = "192.168.100.1"
    severity                = 2  # 0=Unknown, 1=Low, 2=Medium, 3=High
    tags                    = @("apt", "c2", "russia")
    targetProduct           = "Azure Sentinel"
    threatType              = "C2"
    tlpLevel                = "amber"
}

$headers = @{
    Authorization = "Bearer $accessToken"
    "Content-Type" = "application/json"
}

$response = Invoke-RestMethod -Uri "https://graph.microsoft.com/beta/security/tiIndicators" -Method POST -Headers $headers -Body ($indicator | ConvertTo-Json -Depth 10)

Write-Host "Indicator created: $($response.id)"</pre>
                </div>
            </div>

            <h3>Logic Apps Playbook for MISP Integration</h3>
            <div class="code-block">
                <div class="code-header">
                    <span class="code-lang">JSON - Logic App Actions</span>
                    <button class="copy-btn">Copy</button>
                </div>
                <div class="code-content">
<pre>{
  "Get_MISP_Events": {
    "type": "Http",
    "inputs": {
      "method": "POST",
      "uri": "https://your-misp-server/events/restSearch",
      "headers": {
        "Authorization": "@{parameters('MISP_API_Key')}",
        "Content-Type": "application/json"
      },
      "body": {
        "returnFormat": "json",
        "published": true,
        "timestamp": "@{addDays(utcNow(), -1)}"
      }
    }
  },
  "For_Each_Attribute": {
    "type": "Foreach",
    "foreach": "@body('Get_MISP_Events')?['response']",
    "actions": {
      "Upload_to_Sentinel": {
        "type": "Http",
        "inputs": {
          "method": "POST",
          "uri": "https://graph.microsoft.com/beta/security/tiIndicators",
          "authentication": {
            "type": "ManagedServiceIdentity"
          },
          "body": {
            "action": "alert",
            "targetProduct": "Azure Sentinel",
            "networkDestinationIPv4": "@{items('For_Each_Attribute')?['value']}",
            "expirationDateTime": "@{addDays(utcNow(), 30)}"
          }
        }
      }
    }
  }
}</pre>
                </div>
            </div>

            <h2 id="matching">IOC Matching Rules</h2>
            <p>Analytics rules that match logs against threat intelligence indicators.</p>

            <div class="code-block">
                <div class="code-header">
                    <span class="code-lang">KQL - TI Map IP to Network Logs</span>
                    <button class="copy-btn">Copy</button>
                </div>
                <div class="code-content">
<pre>// Match TI IP indicators against firewall logs
let TI_IPs = ThreatIntelligenceIndicator
    | where TimeGenerated > ago(14d)
    | where isnotempty(NetworkIP) or isnotempty(NetworkSourceIP) or isnotempty(NetworkDestinationIP)
    | where Active == true
    | extend TI_IP = coalesce(NetworkIP, NetworkSourceIP, NetworkDestinationIP)
    | summarize LatestIndicator = arg_max(TimeGenerated, *) by TI_IP;
CommonSecurityLog
| where TimeGenerated > ago(1h)
| where isnotempty(DestinationIP) or isnotempty(SourceIP)
| extend TrafficIP = coalesce(DestinationIP, SourceIP)
| join kind=inner TI_IPs on $left.TrafficIP == $right.TI_IP
| project 
    TimeGenerated,
    DeviceVendor,
    DeviceProduct,
    SourceIP,
    DestinationIP,
    TI_IP,
    ThreatType,
    ConfidenceScore,
    Description,
    ThreatIntelIndicatorType = IndicatorType,
    ExpirationDateTime
| extend 
    IPCustomEntity = TI_IP,
    Severity = case(
        ConfidenceScore > 80, "High",
        ConfidenceScore > 50, "Medium",
        "Low"
    )</pre>
                </div>
            </div>

            <div class="code-block">
                <div class="code-header">
                    <span class="code-lang">KQL - TI Map Domain to DNS Events</span>
                    <button class="copy-btn">Copy</button>
                </div>
                <div class="code-content">
<pre>// Match TI domain indicators against DNS queries
let TI_Domains = ThreatIntelligenceIndicator
    | where TimeGenerated > ago(14d)
    | where isnotempty(DomainName)
    | where Active == true
    | summarize LatestIndicator = arg_max(TimeGenerated, *) by DomainName;
DnsEvents
| where TimeGenerated > ago(1h)
| where isnotempty(Name)
| join kind=inner TI_Domains on $left.Name == $right.DomainName
| project 
    TimeGenerated,
    Computer,
    ClientIP,
    Name as QueriedDomain,
    QueryType,
    ThreatType,
    ConfidenceScore,
    Description,
    Tags
| extend 
    HostCustomEntity = Computer,
    IPCustomEntity = ClientIP</pre>
                </div>
            </div>

            <div class="code-block">
                <div class="code-header">
                    <span class="code-lang">KQL - TI Map File Hash to Endpoint Events</span>
                    <button class="copy-btn">Copy</button>
                </div>
                <div class="code-content">
<pre>// Match TI file hashes against MDE file events
let TI_Hashes = ThreatIntelligenceIndicator
    | where TimeGenerated > ago(14d)
    | where isnotempty(FileHashValue)
    | where Active == true
    | extend HashType = FileHashType
    | summarize LatestIndicator = arg_max(TimeGenerated, *) by FileHashValue;
DeviceFileEvents
| where TimeGenerated > ago(1h)
| where ActionType in ("FileCreated", "FileModified")
| extend FileHash = coalesce(SHA256, SHA1, MD5)
| where isnotempty(FileHash)
| join kind=inner TI_Hashes on $left.FileHash == $right.FileHashValue
| project 
    TimeGenerated,
    DeviceName,
    FileName,
    FolderPath,
    FileHash,
    ThreatType,
    MalwareFamilyNames,
    ConfidenceScore,
    Description
| extend 
    HostCustomEntity = DeviceName,
    FileHashCustomEntity = FileHash</pre>
                </div>
            </div>

            <div class="code-block">
                <div class="code-header">
                    <span class="code-lang">KQL - TI Map Email Sender to Mail Events</span>
                    <button class="copy-btn">Copy</button>
                </div>
                <div class="code-content">
<pre>// Match TI email indicators against email events
let TI_Emails = ThreatIntelligenceIndicator
    | where TimeGenerated > ago(14d)
    | where isnotempty(EmailSenderAddress)
    | where Active == true
    | summarize LatestIndicator = arg_max(TimeGenerated, *) by EmailSenderAddress;
EmailEvents
| where TimeGenerated > ago(1h)
| where isnotempty(SenderFromAddress)
| join kind=inner TI_Emails on $left.SenderFromAddress == $right.EmailSenderAddress
| project 
    TimeGenerated,
    RecipientEmailAddress,
    SenderFromAddress,
    Subject,
    ThreatType,
    ConfidenceScore,
    Description,
    Tags
| extend 
    AccountCustomEntity = RecipientEmailAddress</pre>
                </div>
            </div>

            <h2 id="tables">TI Tables</h2>

            <h3>ThreatIntelligenceIndicator Schema</h3>
            <div class="code-block">
                <div class="code-header">
                    <span class="code-lang">KQL - TI Table Schema</span>
                    <button class="copy-btn">Copy</button>
                </div>
                <div class="code-content">
<pre>ThreatIntelligenceIndicator
| getschema

// Key columns:
// TimeGenerated          - When indicator was ingested
// IndicatorType          - Type: IP, Domain, URL, FileHash, Email
// ThreatType             - C2, Malware, Phishing, etc.
// ConfidenceScore        - 0-100 confidence level
// Description            - Human-readable description
// ThreatSeverity         - Low, Medium, High, Unknown
// Active                 - Is indicator currently active
// ExpirationDateTime     - When indicator expires
// Tags                   - Array of tags
// TLP                    - Traffic Light Protocol level

// Network indicators:
// NetworkIP              - IP address
// NetworkSourceIP        - Source IP
// NetworkDestinationIP   - Destination IP
// DomainName             - Domain name
// Url                    - Full URL

// File indicators:
// FileHashValue          - Hash value
// FileHashType           - MD5, SHA1, SHA256

// Email indicators:
// EmailSenderAddress     - Sender email
// EmailSubject           - Email subject pattern

// Attribution:
// ActivityGroupNames     - Threat actor groups
// MalwareFamilyNames     - Malware families
// KillChainActions       - Kill chain phases</pre>
                </div>
            </div>

            <h2 id="queries">TI Queries</h2>

            <div class="code-block">
                <div class="code-header">
                    <span class="code-lang">KQL - TI Indicator Statistics</span>
                    <button class="copy-btn">Copy</button>
                </div>
                <div class="code-content">
<pre>// Overview of all TI indicators
ThreatIntelligenceIndicator
| where TimeGenerated > ago(30d)
| summarize 
    TotalIndicators = count(),
    ActiveIndicators = countif(Active == true),
    ExpiredIndicators = countif(Active == false),
    AvgConfidence = avg(ConfidenceScore)
    by IndicatorType
| sort by TotalIndicators desc</pre>
                </div>
            </div>

            <div class="code-block">
                <div class="code-header">
                    <span class="code-lang">KQL - Indicators by Threat Type</span>
                    <button class="copy-btn">Copy</button>
                </div>
                <div class="code-content">
<pre>ThreatIntelligenceIndicator
| where TimeGenerated > ago(7d)
| where Active == true
| summarize 
    Count = count(),
    Sources = make_set(SourceSystem, 5),
    AvgConfidence = avg(ConfidenceScore)
    by ThreatType
| sort by Count desc
| render barchart</pre>
                </div>
            </div>

            <div class="code-block">
                <div class="code-header">
                    <span class="code-lang">KQL - Recent High-Confidence Indicators</span>
                    <button class="copy-btn">Copy</button>
                </div>
                <div class="code-content">
<pre>ThreatIntelligenceIndicator
| where TimeGenerated > ago(24h)
| where Active == true
| where ConfidenceScore >= 80
| project 
    TimeGenerated,
    IndicatorType,
    Indicator = coalesce(NetworkIP, DomainName, Url, FileHashValue, EmailSenderAddress),
    ThreatType,
    ConfidenceScore,
    Description,
    MalwareFamilyNames,
    ActivityGroupNames,
    ExpirationDateTime
| sort by ConfidenceScore desc, TimeGenerated desc</pre>
                </div>
            </div>

            <div class="code-block">
                <div class="code-header">
                    <span class="code-lang">KQL - Indicators Expiring Soon</span>
                    <button class="copy-btn">Copy</button>
                </div>
                <div class="code-content">
<pre>ThreatIntelligenceIndicator
| where Active == true
| where ExpirationDateTime between (now() .. (now() + 7d))
| summarize ExpiringCount = count() by IndicatorType, bin(ExpirationDateTime, 1d)
| sort by ExpirationDateTime asc</pre>
                </div>
            </div>

            <h2 id="lifecycle">Indicator Lifecycle</h2>

            <div class="ascii-diagram">
<pre>
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         INDICATOR LIFECYCLE                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚   INGEST    â”‚â”€â”€â”€â”€â–¶â”‚   ACTIVE    â”‚â”€â”€â”€â”€â–¶â”‚   EXPIRE    â”‚â”€â”€â”€â”€â–¶â”‚   ARCHIVE   â”‚  â”‚
â”‚   â”‚             â”‚     â”‚             â”‚     â”‚             â”‚     â”‚             â”‚  â”‚
â”‚   â”‚ â€¢ TAXII     â”‚     â”‚ â€¢ Matching  â”‚     â”‚ â€¢ Auto-     â”‚     â”‚ â€¢ Retain    â”‚  â”‚
â”‚   â”‚ â€¢ API       â”‚     â”‚   enabled   â”‚     â”‚   expire    â”‚     â”‚   90 days   â”‚  â”‚
â”‚   â”‚ â€¢ Manual    â”‚     â”‚ â€¢ Alerts    â”‚     â”‚ â€¢ Manual    â”‚     â”‚ â€¢ Query-    â”‚  â”‚
â”‚   â”‚             â”‚     â”‚   generated â”‚     â”‚   disable   â”‚     â”‚   able      â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                                  â”‚
â”‚   LIFECYCLE MANAGEMENT:                                                         â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                          â”‚
â”‚                                                                                  â”‚
â”‚   1. Set appropriate expiration (typically 30-90 days)                          â”‚
â”‚   2. Review expired indicators for re-activation                                â”‚
â”‚   3. Monitor for indicators without matches (may indicate coverage gaps)        â”‚
â”‚   4. Remove duplicate indicators from multiple sources                          â”‚
â”‚   5. Track indicator source quality over time                                   â”‚
â”‚                                                                                  â”‚
â”‚   CONFIDENCE SCORING:                                                           â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                           â”‚
â”‚                                                                                  â”‚
â”‚   90-100: Verified malicious, immediate action                                  â”‚
â”‚   70-89:  High confidence, generate alerts                                      â”‚
â”‚   50-69:  Medium confidence, investigation recommended                          â”‚
â”‚   Below 50: Low confidence, monitoring only                                     â”‚
â”‚                                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</pre>
            </div>

            <h2 id="workbooks">TI Workbooks</h2>

            <div class="code-block">
                <div class="code-header">
                    <span class="code-lang">KQL - TI Dashboard Queries</span>
                    <button class="copy-btn">Copy</button>
                </div>
                <div class="code-content">
<pre>// Indicators ingested over time
ThreatIntelligenceIndicator
| where TimeGenerated > ago(30d)
| summarize Count = count() by bin(TimeGenerated, 1d), IndicatorType
| render timechart

// Top threat types
ThreatIntelligenceIndicator
| where TimeGenerated > ago(7d)
| where Active == true
| summarize Count = count() by ThreatType
| top 10 by Count
| render piechart

// TI matches by source
SecurityAlert
| where TimeGenerated > ago(7d)
| where AlertName has "TI map"
| summarize Matches = count() by AlertName
| render barchart</pre>
                </div>
            </div>

            <div class="alert alert-info">
                <svg class="alert-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"/><path d="M12 16v-4M12 8h.01"/>
                </svg>
                <div class="alert-content">
                    <div class="alert-title">Built-in Workbook</div>
                    <p class="alert-text">Install the "Threat Intelligence" workbook from Content Hub for pre-built dashboards showing indicator statistics, matches, and source health.</p>
                </div>
            </div>

            <h2 id="best-practices">Best Practices</h2>

            <div class="accordion">
                <div class="accordion-item">
                    <button class="accordion-header">
                        Source Selection
                        <svg class="accordion-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"/></svg>
                    </button>
                    <div class="accordion-content">
                        <ul>
                            <li><strong>Start with Microsoft Defender TI:</strong> Native integration, high quality, included with E5</li>
                            <li><strong>Add industry-specific feeds:</strong> FS-ISAC for finance, H-ISAC for healthcare</li>
                            <li><strong>Evaluate source quality:</strong> Track false positive rate per source</li>
                            <li><strong>Avoid duplication:</strong> Same indicator from multiple sources creates noise</li>
                        </ul>
                    </div>
                </div>
                <div class="accordion-item">
                    <button class="accordion-header">
                        Indicator Quality
                        <svg class="accordion-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"/></svg>
                    </button>
                    <div class="accordion-content">
                        <ul>
                            <li><strong>Set confidence thresholds:</strong> Only alert on high-confidence (70+) indicators</li>
                            <li><strong>Include context:</strong> Tags, threat type, kill chain phase improve investigation</li>
                            <li><strong>Set appropriate expiration:</strong> 30-90 days for most indicators</li>
                            <li><strong>Validate indicators:</strong> Periodic review of indicator accuracy</li>
                        </ul>
                    </div>
                </div>
                <div class="accordion-item">
                    <button class="accordion-header">
                        Detection Rules
                        <svg class="accordion-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"/></svg>
                    </button>
                    <div class="accordion-content">
                        <ul>
                            <li><strong>Use built-in TI Map rules:</strong> Microsoft provides optimized matching rules</li>
                            <li><strong>Filter by confidence:</strong> Don't alert on low-confidence indicators</li>
                            <li><strong>Set appropriate severity:</strong> Map confidence score to alert severity</li>
                            <li><strong>Include whitelists:</strong> Exclude known-good IPs/domains</li>
                        </ul>
                    </div>
                </div>
                <div class="accordion-item">
                    <button class="accordion-header">
                        Investigation Workflow
                        <svg class="accordion-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"/></svg>
                    </button>
                    <div class="accordion-content">
                        <ul>
                            <li><strong>Verify indicator context:</strong> Check source, confidence, threat type</li>
                            <li><strong>Correlate with other data:</strong> UEBA, Identity Protection, MDE alerts</li>
                            <li><strong>Use enrichment playbooks:</strong> Auto-lookup IP reputation, WHOIS, etc.</li>
                            <li><strong>Document false positives:</strong> Improve indicator quality over time</li>
                        </ul>
                    </div>
                </div>
            </div>

            <footer class="footer">
                <div class="footer-content">
                    <svg class="footer-icon" viewBox="0 0 24 24">
                        <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>
                    </svg>
                    Microsoft Sentinel Ultimate Guide
                </div>
            </footer>
        </div>
    </main>
    <script src="main.js"></script>
</body>
</html>
