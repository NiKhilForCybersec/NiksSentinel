<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Insider Threat Use Cases - Detecting malicious insiders, compromised accounts, and policy violations.">
    <title>Insider Threats | SIEM Mastery Guide</title>
    <link rel="stylesheet" href="main.css">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ›¡ï¸</text></svg>">
</head>
<body>
    <div class="page-wrapper">
        <button class="mobile-menu-toggle" aria-label="Toggle navigation menu">
            <div class="hamburger"><span></span><span></span><span></span></div>
        </button>
        <div class="sidebar-overlay"></div>
        
        <aside class="sidebar">
            <div class="sidebar-header">
                <a href="index.html" class="sidebar-logo">
                    <div class="logo-icon">ğŸ›¡ï¸</div>
                    <div>
                        <div class="logo-text">SIEM Mastery</div>
                        <div class="logo-subtext">Documentation</div>
                    </div>
                </a>
            </div>
            
                        <nav class="sidebar-nav">
                <!-- Section 1: SIEM Fundamentals -->
                <div class="nav-section">
                    <div class="nav-section-header">
                        <span class="nav-section-title">
                            <span class="nav-section-icon">ğŸ“š</span>
                            <span>SIEM Fundamentals</span>
                        </span>
                        <span class="nav-section-arrow">â–¶</span>
                    </div>
                    <div class="nav-section-items">
                        <a href="1-1-introduction-to-siem.html" class="nav-item">1.1 Introduction to SIEM</a>
                        <a href="1-2-architecture-components.html" class="nav-item">1.2 Architecture & Components</a>
                        <a href="1-3-log-sources-onboarding.html" class="nav-item">1.3 Log Sources & Onboarding</a>
                        <a href="1-4-log-parsing-normalization.html" class="nav-item">1.4 Log Parsing & Normalization</a>
                        <a href="1-5-detection-engineering-fundamentals.html" class="nav-item">1.5 Detection Engineering</a>
                        <a href="1-6-soc-operations-siem.html" class="nav-item">1.6 SOC Operations & SIEM</a>
                    </div>
                </div>
                
                <!-- Section 2: Splunk Fundamentals -->
                <div class="nav-section">
                    <div class="nav-section-header">
                        <span class="nav-section-title">
                            <span class="nav-section-icon">ğŸŸ¢</span>
                            <span>Splunk Fundamentals</span>
                        </span>
                        <span class="nav-section-arrow">â–¶</span>
                    </div>
                    <div class="nav-section-items">
                        <a href="2-1-splunk-architecture.html" class="nav-item">2.1 Splunk Architecture</a>
                        <a href="2-2-installation-configuration.html" class="nav-item">2.2 Installation & Configuration</a>
                        <a href="2-3-data-ingestion.html" class="nav-item">2.3 Data Ingestion</a>
                        <a href="2-4-index-management.html" class="nav-item">2.4 Index Management</a>
                        <a href="2-5-spl-fundamentals.html" class="nav-item">2.5 SPL Fundamentals</a>
                        <a href="2-6-spl-data-retrieval.html" class="nav-item">2.6 SPL Data Retrieval</a>
                        <a href="2-7-spl-transforming.html" class="nav-item">2.7 SPL Transforming</a>
                        <a href="2-8-spl-manipulation.html" class="nav-item">2.8 SPL Manipulation</a>
                        <a href="2-9-spl-advanced.html" class="nav-item">2.9 SPL Advanced</a>
                        <a href="2-10-search-optimization.html" class="nav-item">2.10 Search Optimization</a>
                    </div>
                </div>
                
                <!-- Section 3: Splunk Security Operations -->
                <div class="nav-section">
                    <div class="nav-section-header">
                        <span class="nav-section-title">
                            <span class="nav-section-icon">ğŸ”’</span>
                            <span>Splunk Security Ops</span>
                        </span>
                        <span class="nav-section-arrow">â–¶</span>
                    </div>
                    <div class="nav-section-items">
                        <a href="3-1-splunk-es-overview.html" class="nav-item">3.1 Enterprise Security Overview</a>
                        <a href="3-2-notable-events.html" class="nav-item">3.2 Notable Events</a>
                        <a href="3-3-correlation-searches.html" class="nav-item">3.3 Correlation Searches</a>
                        <a href="3-4-risk-based-alerting.html" class="nav-item">3.4 Risk-Based Alerting</a>
                        <a href="3-5-threat-intelligence.html" class="nav-item">3.5 Threat Intelligence</a>
                        <a href="3-6-asset-identity.html" class="nav-item">3.6 Asset & Identity</a>
                        <a href="3-7-security-dashboards.html" class="nav-item">3.7 Security Dashboards</a>
                        <a href="3-8-es-administration.html" class="nav-item">3.8 ES Administration</a>
                    </div>
                </div>
                
                <!-- Section 4: Splunk SOAR -->
                <div class="nav-section">
                    <div class="nav-section-header">
                        <span class="nav-section-title">
                            <span class="nav-section-icon">âš¡</span>
                            <span>Splunk SOAR</span>
                        </span>
                        <span class="nav-section-arrow">â–¶</span>
                    </div>
                    <div class="nav-section-items">
                        <a href="4-1-soar-overview.html" class="nav-item">4.1 SOAR Overview</a>
                        <a href="4-2-playbooks.html" class="nav-item">4.2 Playbooks</a>
                        <a href="4-3-apps-integrations.html" class="nav-item">4.3 Apps & Integrations</a>
                        <a href="4-4-case-management.html" class="nav-item">4.4 Case Management</a>
                    </div>
                </div>
                
                <!-- Section 5: Microsoft Sentinel Fundamentals -->
                <div class="nav-section">
                    <div class="nav-section-header">
                        <span class="nav-section-title">
                            <span class="nav-section-icon">ğŸ”·</span>
                            <span>Sentinel Fundamentals</span>
                        </span>
                        <span class="nav-section-arrow">â–¶</span>
                    </div>
                    <div class="nav-section-items">
                        <a href="5-1-sentinel-architecture.html" class="nav-item">5.1 Sentinel Architecture</a>
                        <a href="5-2-log-analytics.html" class="nav-item">5.2 Log Analytics Workspace</a>
                        <a href="5-3-data-connectors.html" class="nav-item">5.3 Data Connectors</a>
                        <a href="5-4-kql-fundamentals.html" class="nav-item">5.4 KQL Fundamentals</a>
                        <a href="5-5-kql-advanced.html" class="nav-item">5.5 KQL Advanced</a>
                        <a href="5-6-analytics-rules.html" class="nav-item">5.6 Analytics Rules</a>
                        <a href="5-7-incidents-investigation.html" class="nav-item">5.7 Incidents & Investigation</a>
                        <a href="5-8-workbooks-reporting.html" class="nav-item">5.8 Workbooks & Reporting</a>
                    </div>
                </div>
                
                <!-- Section 6: Sentinel Security Operations -->
                <div class="nav-section">
                    <div class="nav-section-header">
                        <span class="nav-section-title">
                            <span class="nav-section-icon">ğŸ”¶</span>
                            <span>Sentinel Security Ops</span>
                        </span>
                        <span class="nav-section-arrow">â–¶</span>
                    </div>
                    <div class="nav-section-items">
                        <a href="6-1-automation-playbooks.html" class="nav-item">6.1 Automation & Playbooks</a>
                        <a href="6-2-watchlists-ti.html" class="nav-item">6.2 Watchlists & Threat Intel</a>
                        <a href="6-3-ueba.html" class="nav-item">6.3 UEBA</a>
                        <a href="6-4-sentinel-administration.html" class="nav-item">6.4 Sentinel Administration</a>
                    </div>
                </div>
                
                <!-- Section 7: SIEM Comparison -->
                <div class="nav-section">
                    <div class="nav-section-header">
                        <span class="nav-section-title">
                            <span class="nav-section-icon">ğŸ”€</span>
                            <span>SIEM Comparison</span>
                        </span>
                        <span class="nav-section-arrow">â–¶</span>
                    </div>
                    <div class="nav-section-items">
                        <a href="7-1-splunk-vs-sentinel.html" class="nav-item">7.1 Splunk vs Sentinel</a>
                        <a href="7-2-query-language-comparison.html" class="nav-item">7.2 SPL vs KQL</a>
                        <a href="7-3-migration-considerations.html" class="nav-item">7.3 Migration Guide</a>
                    </div>
                </div>
                
                <!-- Section 8: Detection Engineering -->
                <div class="nav-section">
                    <div class="nav-section-header">
                        <span class="nav-section-title">
                            <span class="nav-section-icon">ğŸ¯</span>
                            <span>Detection Engineering</span>
                        </span>
                        <span class="nav-section-arrow">â–¶</span>
                    </div>
                    <div class="nav-section-items">
                        <a href="8-1-detection-development.html" class="nav-item">8.1 Detection Development</a>
                        <a href="8-2-mitre-attack.html" class="nav-item">8.2 MITRE ATT&CK</a>
                        <a href="8-3-sigma-rules.html" class="nav-item">8.3 SIGMA Rules</a>
                        <a href="8-4-detection-testing.html" class="nav-item">8.4 Testing & Validation</a>
                    </div>
                </div>
                
                <!-- Section 9: Threat Hunting -->
                <div class="nav-section">
                    <div class="nav-section-header">
                        <span class="nav-section-title">
                            <span class="nav-section-icon">ğŸ”</span>
                            <span>Threat Hunting</span>
                        </span>
                        <span class="nav-section-arrow">â–¶</span>
                    </div>
                    <div class="nav-section-items">
                        <a href="9-1-hunting-fundamentals.html" class="nav-item">9.1 Hunting Fundamentals</a>
                        <a href="9-2-hunting-methodologies.html" class="nav-item">9.2 Hunting Methodologies</a>
                        <a href="9-3-hunting-queries.html" class="nav-item">9.3 Hunting Queries</a>
                    </div>
                </div>
                
                <!-- Section 10: Use Case Library -->
                <div class="nav-section expanded">
                    <div class="nav-section-header">
                        <span class="nav-section-title">
                            <span class="nav-section-icon">ğŸ“</span>
                            <span>Use Case Library</span>
                        </span>
                        <span class="nav-section-arrow">â–¶</span>
                    </div>
                    <div class="nav-section-items">
                        <a href="10-1-authentication-attacks.html" class="nav-item">10.1 Authentication Attacks</a>
                        <a href="10-2-malware-execution.html" class="nav-item">10.2 Malware & Execution</a>
                        <a href="10-3-data-exfiltration.html" class="nav-item">10.3 Data Exfiltration</a>
                        <a href="10-4-insider-threats.html" class="nav-item active">10.4 Insider Threats</a>
                    </div>
                </div>
                <!-- Appendices -->
                <div class="nav-section">
                    <div class="nav-section-header">
                        <span class="nav-section-title">
                            <span class="nav-section-icon">ğŸ“–</span>
                            <span>Appendices</span>
                        </span>
                        <span class="nav-section-arrow">â–¶</span>
                    </div>
                    <div class="nav-section-items">
                        <a href="a-1-windows-security-fundamentals.html" class="nav-item">A.1 Windows Security</a>
                        <a href="a-2-network-fundamentals.html" class="nav-item">A.2 Network Fundamentals</a>
                        <a href="a-3-use-case-development.html" class="nav-item">A.3 Use Case Development</a>
                        <a href="a-4-siem-migration-guide.html" class="nav-item">A.4 SIEM Migration Guide</a>
                        <a href="a-5-siem-design-from-scratch.html" class="nav-item">A.5 Design from Scratch</a>
                    </div>
                </div>
            </nav>
            
            <div class="sidebar-footer">
                <p>Built for Security Engineers</p>
            </div>
        </aside>
        
        <main class="main-content">
            <header class="content-header">
                <nav class="breadcrumb">
                    <a href="index.html">Home</a>
                    <span class="breadcrumb-separator">/</span>
                    <a href="10-1-authentication-attacks.html">Use Case Library</a>
                    <span class="breadcrumb-separator">/</span>
                    <span class="breadcrumb-current">Insider Threats</span>
                </nav>
            </header>
            
            <div class="content-area">
                <h1 class="page-title">Insider Threat Use Cases</h1>
                <p class="page-subtitle">Detection rules for malicious insiders, account misuse, and behavioral anomalies</p>
                
                <div class="info-box overview">
                    <div class="info-box-header">
                        <span class="info-box-icon">ğŸ“˜</span>
                        Chapter Overview
                    </div>
                    <div class="info-box-content">
                        <p>
                            Insider threats are among the hardest to detect because insiders have legitimate access. This chapter covers behavioral analytics, privilege abuse detection, and indicators of malicious insider activity.
                        </p>
                    </div>
                </div>
                
                <h2 id="insider-types">Insider Threat Categories</h2>
                
                <pre><code class="language-text">INSIDER THREAT TYPES:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ TYPE             â”‚ DESCRIPTION                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ MALICIOUS        â”‚ Intentional harm by employee        â”‚
â”‚ INSIDER          â”‚ Theft, sabotage, espionage          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ NEGLIGENT        â”‚ Accidental policy violations        â”‚
â”‚ INSIDER          â”‚ Mishandling data, weak passwords    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ COMPROMISED      â”‚ Account taken over by attacker      â”‚
â”‚ INSIDER          â”‚ Appears as legitimate user          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ DEPARTING        â”‚ Employees leaving organization      â”‚
â”‚ EMPLOYEE         â”‚ Higher risk period for data theft   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

KEY INDICATORS:
â€¢ Unusual access patterns
â€¢ Access outside job role
â€¢ After-hours activity
â€¢ Mass data access/download
â€¢ Behavioral changes
â€¢ Circumventing security controls</code></pre>
                
                <h2 id="departing-employee">Use Case: Departing Employee Monitoring</h2>
                
                <pre><code class="language-text">USE CASE: DEPARTING EMPLOYEE RISK
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

DESCRIPTION:
Employees leaving the organization pose elevated risk.
Monitor for data collection and exfiltration attempts.

RISK WINDOW:
â€¢ 2 weeks before announced departure
â€¢ Resignation to last day
â€¢ After-hours access increases
â€¢ Unusual file access patterns</code></pre>
                
                <h3>Sentinel KQL - Departing Employee Activity</h3>
                
                <pre><code class="language-kql">// Create departing employee watchlist first
// Then monitor their activity
let DepartingEmployees = _GetWatchlist('DepartingEmployees')
| project UserPrincipalName;
// File Downloads by Departing Employees
CloudAppEvents
| where TimeGenerated > ago(7d)
| where ActionType == "FileDownloaded"
| where AccountDisplayName in (DepartingEmployees)
| summarize 
    DownloadCount = count(),
    TotalSize = sum(ActivityObjects[0].Size),
    Files = make_set(ActivityObjects[0].Name, 20)
    by AccountDisplayName, Application, bin(TimeGenerated, 1d)
| extend SizeMB = round(TotalSize / 1048576.0, 2)
| where DownloadCount > 50 or SizeMB > 100

// Email Activity by Departing Employees
EmailEvents
| where TimeGenerated > ago(7d)
| where SenderFromAddress in (DepartingEmployees)
| where EmailDirection == "Outbound"
| where RecipientEmailAddress !endswith "@yourdomain.com"
| summarize 
    ExternalEmails = count(),
    WithAttachments = countif(AttachmentCount > 0),
    Recipients = make_set(RecipientEmailAddress, 10)
    by SenderFromAddress, bin(TimeGenerated, 1d)
| where ExternalEmails > 20 or WithAttachments > 5

// Login Activity Changes
let DepartingUsers = _GetWatchlist('DepartingEmployees') | project UPN = UserPrincipalName;
let Baseline = SigninLogs
| where TimeGenerated between (ago(60d) .. ago(30d))
| where UserPrincipalName in (DepartingUsers)
| summarize AvgLoginsPerDay = count() / 30 by UserPrincipalName;
SigninLogs
| where TimeGenerated > ago(7d)
| where UserPrincipalName in (DepartingUsers)
| summarize CurrentLogins = count() by UserPrincipalName
| join kind=inner Baseline on UserPrincipalName
| extend LoginChange = (CurrentLogins - (AvgLoginsPerDay * 7)) / (AvgLoginsPerDay * 7) * 100
| where LoginChange > 50  // 50% increase</code></pre>
                
                <h2 id="privilege-abuse">Use Case: Privilege Abuse</h2>
                
                <pre><code class="language-text">USE CASE: PRIVILEGE ABUSE DETECTION
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

DESCRIPTION:
Detect misuse of elevated privileges including 
unauthorized access and role boundary violations.

INDICATORS:
â€¢ Admin accessing user data without ticket
â€¢ Accessing systems outside job function
â€¢ Privilege escalation patterns
â€¢ Excessive permissions use</code></pre>
                
                <h3>Sentinel KQL - Privilege Abuse</h3>
                
                <pre><code class="language-kql">// First-Time Admin Actions
let HistoricalAdminActions = AuditLogs
| where TimeGenerated between (ago(30d) .. ago(1d))
| where Category == "RoleManagement" or Category == "UserManagement"
| distinct OperationName, InitiatedBy.user.userPrincipalName;
AuditLogs
| where TimeGenerated > ago(24h)
| where Category == "RoleManagement" or Category == "UserManagement"
| extend AdminUser = tostring(InitiatedBy.user.userPrincipalName)
| join kind=leftanti HistoricalAdminActions 
    on OperationName, $left.AdminUser == $right.["InitiatedBy.user.userPrincipalName"]
| project TimeGenerated, AdminUser, OperationName, 
    Target = TargetResources[0].userPrincipalName

// Accessing Resources Outside Normal Scope
// Requires asset/resource classification
let UserResourceMapping = datatable(Department: string, AllowedResources: dynamic) [
    "Finance", dynamic(["FinanceShare", "ERPSystem"]),
    "Engineering", dynamic(["CodeRepo", "DevServers"]),
    "HR", dynamic(["HRSystem", "PayrollDB"])
];
// Join with user department and check access
DeviceFileEvents
| where TimeGenerated > ago(24h)
| join kind=inner (
    IdentityInfo | project AccountName, Department
) on AccountName
| join kind=inner UserResourceMapping on Department
| where FolderPath !has_any (AllowedResources)
| project TimeGenerated, AccountName, Department, 
    AccessedResource = FolderPath

// Password Reset by Non-Helpdesk
AuditLogs
| where TimeGenerated > ago(24h)
| where OperationName == "Reset user password"
| extend Initiator = tostring(InitiatedBy.user.userPrincipalName)
| extend Target = tostring(TargetResources[0].userPrincipalName)
// Check if initiator is helpdesk
| join kind=leftanti (
    IdentityInfo 
    | where GroupMembership has "Helpdesk"
    | project UPN = AccountUPN
) on $left.Initiator == $right.UPN
| project TimeGenerated, Initiator, Target, OperationName</code></pre>
                
                <h2 id="behavioral-anomaly">Use Case: Behavioral Anomalies</h2>
                
                <pre><code class="language-text">USE CASE: BEHAVIORAL ANOMALY DETECTION
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

DESCRIPTION:
Detect deviations from established user behavior patterns
that may indicate compromise or malicious activity.

BEHAVIORAL DIMENSIONS:
â€¢ Login times
â€¢ Access patterns
â€¢ Data volume
â€¢ Application usage
â€¢ Geographic location</code></pre>
                
                <h3>Sentinel KQL - Behavioral Anomalies</h3>
                
                <pre><code class="language-kql">// Off-Hours Login Anomaly
let BusinessHours = (Hour: int) { Hour >= 8 and Hour <= 18 };
let UserBaseline = SigninLogs
| where TimeGenerated between (ago(30d) .. ago(1d))
| extend Hour = datetime_part("hour", TimeGenerated)
| summarize 
    TotalLogins = count(),
    OffHoursLogins = countif(Hour < 8 or Hour > 18)
    by UserPrincipalName
| extend OffHoursRatio = OffHoursLogins * 1.0 / TotalLogins;
SigninLogs
| where TimeGenerated > ago(24h)
| extend Hour = datetime_part("hour", TimeGenerated)
| where Hour < 8 or Hour > 18
| summarize TodayOffHours = count() by UserPrincipalName
| join kind=inner UserBaseline on UserPrincipalName
| where TodayOffHours > 5 and OffHoursRatio < 0.1  // Usually works normal hours

// Unusual Application Access
let UserAppBaseline = CloudAppEvents
| where TimeGenerated between (ago(30d) .. ago(1d))
| summarize Apps = make_set(Application) by AccountDisplayName;
CloudAppEvents
| where TimeGenerated > ago(24h)
| join kind=inner UserAppBaseline on AccountDisplayName
| where Application !in (Apps)
| summarize NewApps = make_set(Application) by AccountDisplayName

// Sudden Increase in Data Access
let UserVolumeBaseline = CloudAppEvents
| where TimeGenerated between (ago(30d) .. ago(1d))
| where ActionType in ("FileDownloaded", "FileAccessed")
| summarize 
    AvgDailyAccess = count() / 30,
    StdDev = stdev(count())
    by AccountDisplayName;
CloudAppEvents
| where TimeGenerated > ago(1d)
| where ActionType in ("FileDownloaded", "FileAccessed")
| summarize TodayAccess = count() by AccountDisplayName
| join kind=inner UserVolumeBaseline on AccountDisplayName
| where TodayAccess > AvgDailyAccess + (3 * StdDev)
| project AccountDisplayName, TodayAccess, AvgDailyAccess,
    Anomaly = "Unusual data access volume"</code></pre>
                
                <h2 id="ueba-integration">UEBA Integration</h2>
                
                <pre><code class="language-text">LEVERAGING UEBA FOR INSIDER THREATS:

SENTINEL UEBA ENTITIES:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Entity Type    â”‚ Behavioral Signals                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ User           â”‚ Login patterns, data access,         â”‚
â”‚                â”‚ app usage, peer comparison           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Host           â”‚ Process execution, network traffic,  â”‚
â”‚                â”‚ file operations                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ IP Address     â”‚ Geographic location, ISP,            â”‚
â”‚                â”‚ reputation, historical access        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</code></pre>
                
                <h3>Sentinel KQL - UEBA Queries</h3>
                
                <pre><code class="language-kql">// High-Risk Users from UEBA
BehaviorAnalytics
| where TimeGenerated > ago(7d)
| where ActivityType == "AnomalousLogon" 
    or ActivityType == "UnusualDataAccess"
| summarize 
    AnomalyCount = count(),
    HighestScore = max(InvestigationPriority)
    by UserPrincipalName
| where AnomalyCount > 3 or HighestScore > 7
| sort by HighestScore desc

// Users with Multiple Anomaly Types
BehaviorAnalytics
| where TimeGenerated > ago(7d)
| summarize 
    AnomalyTypes = make_set(ActivityType),
    TotalAnomalies = count(),
    AvgScore = avg(InvestigationPriority)
    by UserPrincipalName
| extend UniqueAnomalyTypes = array_length(AnomalyTypes)
| where UniqueAnomalyTypes > 2
| sort by AvgScore desc

// Entity Timeline for Investigation
let TargetUser = "<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="e6959395968f858f899395c893958394a682898b878f88c885898b">[email&#160;protected]</a>";
union
    (SigninLogs | where UserPrincipalName == TargetUser 
        | project TimeGenerated, Activity = "Login", Details = strcat(IPAddress, " - ", Location)),
    (CloudAppEvents | where AccountDisplayName == TargetUser 
        | project TimeGenerated, Activity = ActionType, Details = Application),
    (AuditLogs | where InitiatedBy.user.userPrincipalName == TargetUser 
        | project TimeGenerated, Activity = OperationName, Details = "Admin Action")
| sort by TimeGenerated desc
| take 100</code></pre>
                
                <h2 id="policy-violations">Use Case: Policy Violations</h2>
                
                <pre><code class="language-text">USE CASE: SECURITY POLICY VIOLATIONS
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

COMMON VIOLATIONS:
â€¢ Sharing credentials
â€¢ Bypassing security controls
â€¢ Unauthorized software installation
â€¢ Accessing blocked websites
â€¢ Disabling security tools</code></pre>
                
                <h3>Sentinel KQL - Policy Violations</h3>
                
                <pre><code class="language-kql">// Credential Sharing Detection (Multiple Locations)
SigninLogs
| where TimeGenerated > ago(1h)
| where ResultType == 0
| summarize 
    UniqueIPs = dcount(IPAddress),
    UniqueLocations = dcount(Location),
    IPs = make_set(IPAddress, 5),
    Locations = make_set(Location, 5)
    by UserPrincipalName
| where UniqueIPs > 2 and UniqueLocations > 2

// Security Tool Disabled
DeviceEvents
| where TimeGenerated > ago(24h)
| where ActionType in ("AntivirusDetectionActionBlocked", 
    "TamperingAttempt", "SecurityServiceStopped")
| project TimeGenerated, DeviceName, AccountName,
    ActionType, FileName

// Unauthorized Software Installation
DeviceEvents
| where TimeGenerated > ago(24h)
| where ActionType == "AppInstalled"
| where FileName !in~ (
    // Approved software list
    "Microsoft", "Adobe", "Chrome", "Firefox"
)
| project TimeGenerated, DeviceName, AccountName,
    InstalledApp = FileName

// VPN/Proxy Bypass Attempts
DeviceNetworkEvents
| where TimeGenerated > ago(24h)
| where RemoteUrl has_any (
    "anonymizer", "hidemyass", "vpngate",
    "tor-exit", "proxy.org"
)
| project TimeGenerated, DeviceName, AccountName,
    AttemptedBypass = RemoteUrl</code></pre>
                
                <div class="info-box warning">
                    <div class="info-box-header">
                        <span class="info-box-icon">âš ï¸</span>
                        Privacy & Legal Considerations
                    </div>
                    <div class="info-box-content">
                        <p>
                            <strong>Important:</strong><br>
                            â–¡ Work with Legal/HR before implementing insider monitoring<br>
                            â–¡ Ensure compliance with local privacy laws (GDPR, etc.)<br>
                            â–¡ Document legitimate business purpose<br>
                            â–¡ Limit access to insider threat data<br>
                            â–¡ Have proper policies and employee notification<br>
                            â–¡ Balance security with employee privacy
                        </p>
                    </div>
                </div>
                
                <div class="info-box interview">
                    <div class="info-box-header">
                        <span class="info-box-icon">ğŸ’¼</span>
                        Interview Question
                    </div>
                    <div class="info-box-content">
                        <p>
                            <strong>"How would you detect insider threats using SIEM?"</strong><br><br>
                            Insider threat detection requires a multi-layered approach:<br><br>
                            
                            <strong>1. Behavioral Baselining:</strong><br>
                            Establish normal patterns for each userâ€”login times, applications used, data access volumeâ€”then alert on significant deviations.<br><br>
                            
                            <strong>2. Risk-Based Monitoring:</strong><br>
                            Focus on high-risk groups: departing employees, users with privileged access, those who recently had performance issues.<br><br>
                            
                            <strong>3. Data-Centric Detection:</strong><br>
                            Monitor access to sensitive data repositories, large downloads, and exfiltration channels (cloud, email, USB).<br><br>
                            
                            <strong>4. UEBA Integration:</strong><br>
                            Leverage User Entity Behavior Analytics to automatically detect anomalies and assign risk scores based on multiple behavioral dimensions.<br><br>
                            
                            <strong>5. Peer Comparison:</strong><br>
                            Compare user behavior against their peer group to identify outliersâ€”a finance employee accessing engineering systems is suspicious.
                        </p>
                    </div>
                </div>
                
                <h2 id="summary">Chapter Summary</h2>
                
                <ul>
                    <li>Insider threats include malicious, negligent, and compromised insiders</li>
                    <li>Departing employees require elevated monitoring during risk period</li>
                    <li>Behavioral baselines are essential for anomaly detection</li>
                    <li>UEBA provides automated behavioral analysis across multiple dimensions</li>
                    <li>Balance security monitoring with privacy and legal requirements</li>
                    <li>Combine multiple signals for high-confidence detection</li>
                </ul>
                
                <div class="info-box tip">
                    <div class="info-box-header">
                        <span class="info-box-icon">ğŸ‰</span>
                        Use Case Library Complete
                    </div>
                    <div class="info-box-content">
                        <p>
                            Congratulations! You've completed <strong>Section 10: Use Case Library</strong>. You now have production-ready detection rules for authentication attacks, malware execution, data exfiltration, and insider threatsâ€”all with both SPL and KQL examples.
                        </p>
                    </div>
                </div>
                
                <div class="page-navigation">
                    <a href="10-3-data-exfiltration.html" class="nav-button prev">
                        <span class="nav-button-icon">â†</span>
                        <div>
                            <span class="nav-button-label">Previous</span>
                            <span class="nav-button-title">Data Exfiltration</span>
                        </div>
                    </a>
                    <a href="index.html" class="nav-button next">
                        <span class="nav-button-icon">â†’</span>
                        <div>
                            <span class="nav-button-label">Back to</span>
                            <span class="nav-button-title">Home</span>
                        </div>
                    </a>
                </div>
            </div>
        </main>
    </div>
    
    <script src="main.js"></script>
</body>
</html>
